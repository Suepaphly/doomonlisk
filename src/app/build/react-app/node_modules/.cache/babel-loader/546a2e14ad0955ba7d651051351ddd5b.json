{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _toConsumableArray = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _regeneratorRuntime = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createDefaultApplicationEnv = exports.ApplicationEnv = void 0;\n\nvar lisk_api_client_1 = require(\"@liskhq/lisk-api-client\");\n\nvar lisk_codec_1 = require(\"@liskhq/lisk-codec\");\n\nvar path_1 = require(\"path\");\n\nvar lisk_utils_1 = require(\"@liskhq/lisk-utils\");\n\nvar os_1 = require(\"os\");\n\nvar fs_extra_1 = require(\"fs-extra\");\n\nvar fixtures_1 = require(\"./fixtures\");\n\nvar create_genesis_block_1 = require(\"./create_genesis_block\");\n\nvar application_1 = require(\"../application\");\n\nvar modules_1 = require(\"../modules\");\n\nvar ApplicationEnv = /*#__PURE__*/function () {\n  function ApplicationEnv(appConfig) {\n    _classCallCheck(this, ApplicationEnv);\n\n    this._initApplication(appConfig);\n  }\n\n  _createClass(ApplicationEnv, [{\n    key: \"application\",\n    get: function get() {\n      return this._application;\n    }\n  }, {\n    key: \"ipcClient\",\n    get: function get() {\n      return this._ipcClient;\n    }\n  }, {\n    key: \"dataPath\",\n    get: function get() {\n      return this._dataPath;\n    }\n  }, {\n    key: \"networkIdentifier\",\n    get: function get() {\n      return this._application.networkIdentifier;\n    }\n  }, {\n    key: \"lastBlock\",\n    get: function get() {\n      return this._application['_node']['_chain'].lastBlock;\n    }\n  }, {\n    key: \"startApplication\",\n    value: function () {\n      var _startApplication = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this._application['_genesisBlock'] = this._genesisBlock;\n                _context.next = 3;\n                return Promise.race([this._application.run(), new Promise(function (resolve) {\n                  return setTimeout(resolve, 3000);\n                })]);\n\n              case 3:\n                if (!(this._application.config.rpc.enable && this._application.config.rpc.mode === 'ipc')) {\n                  _context.next = 7;\n                  break;\n                }\n\n                _context.next = 6;\n                return lisk_api_client_1.createIPCClient(this._dataPath);\n\n              case 6:\n                this._ipcClient = _context.sent;\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function startApplication() {\n        return _startApplication.apply(this, arguments);\n      }\n\n      return startApplication;\n    }()\n  }, {\n    key: \"stopApplication\",\n    value: function () {\n      var _stopApplication = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var options,\n            _args2 = arguments;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                options = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {\n                  clearDB: true\n                };\n\n                if (!options.clearDB) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                _context2.next = 4;\n                return this._application['_forgerDB'].clear();\n\n              case 4:\n                _context2.next = 6;\n                return this._application['_blockchainDB'].clear();\n\n              case 6:\n                _context2.next = 8;\n                return this._application['_nodeDB'].clear();\n\n              case 8:\n                if (!(this._application.config.rpc.enable && this._application.config.rpc.mode === 'ipc')) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                _context2.next = 11;\n                return this._ipcClient.disconnect();\n\n              case 11:\n                _context2.next = 13;\n                return this._application.shutdown();\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function stopApplication() {\n        return _stopApplication.apply(this, arguments);\n      }\n\n      return stopApplication;\n    }()\n  }, {\n    key: \"waitNBlocks\",\n    value: function () {\n      var _waitNBlocks = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _this = this;\n\n        var n,\n            height,\n            _args3 = arguments;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                n = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : 1;\n                height = this.lastBlock.header.height + n;\n                return _context3.abrupt(\"return\", new Promise(function (resolve) {\n                  _this._application['_channel'].subscribe('app:block:new', function () {\n                    if (_this.lastBlock.header.height >= height) {\n                      resolve();\n                    }\n                  });\n                }));\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function waitNBlocks() {\n        return _waitNBlocks.apply(this, arguments);\n      }\n\n      return waitNBlocks;\n    }()\n  }, {\n    key: \"_initApplication\",\n    value: function _initApplication(appConfig) {\n      var _a, _b, _c;\n\n      lisk_codec_1.codec.clearCache();\n\n      var _create_genesis_block = create_genesis_block_1.createGenesisBlock({\n        modules: appConfig.modules\n      }),\n          genesisBlockJSON = _create_genesis_block.genesisBlockJSON;\n\n      this._genesisBlock = (_a = appConfig.genesisBlockJSON) !== null && _a !== void 0 ? _a : genesisBlockJSON;\n      var config = lisk_utils_1.objects.mergeDeep({}, fixtures_1.defaultConfig, (_b = appConfig.config) !== null && _b !== void 0 ? _b : {});\n      var label = config.label;\n      var application = new application_1.Application(this._genesisBlock, config);\n      appConfig.modules.map(function (module) {\n        return application.registerModule(module);\n      });\n      (_c = appConfig.plugins) === null || _c === void 0 ? void 0 : _c.map(function (plugin) {\n        return application.registerPlugin(plugin);\n      });\n      this._dataPath = path_1.join(application.config.rootPath, label);\n      this._application = application;\n      return application;\n    }\n  }]);\n\n  return ApplicationEnv;\n}();\n\nexports.ApplicationEnv = ApplicationEnv;\n\nvar createDefaultApplicationEnv = function createDefaultApplicationEnv(appEnvConfig) {\n  var _a, _b, _c, _d, _e;\n\n  var rootPath = (_b = (_a = appEnvConfig.config) === null || _a === void 0 ? void 0 : _a.rootPath) !== null && _b !== void 0 ? _b : fixtures_1.defaultConfig.rootPath;\n  var label = (_d = (_c = appEnvConfig.config) === null || _c === void 0 ? void 0 : _c.label) !== null && _d !== void 0 ? _d : fixtures_1.defaultConfig.label;\n  var dataPath = path_1.join(rootPath.replace('~', os_1.homedir()), label);\n\n  if (fs_extra_1.existsSync(dataPath)) {\n    fs_extra_1.rmdirSync(dataPath, {\n      recursive: true\n    });\n  }\n\n  var defaultModules = [modules_1.TokenModule, modules_1.SequenceModule, modules_1.KeysModule, modules_1.DPoSModule];\n\n  var modules = _toConsumableArray(new Set([].concat(_toConsumableArray((_e = appEnvConfig.modules) !== null && _e !== void 0 ? _e : []), defaultModules)));\n\n  var faucetAccount = {\n    address: fixtures_1.defaultFaucetAccount.address,\n    token: {\n      balance: BigInt(fixtures_1.defaultFaucetAccount.balance)\n    },\n    sequence: {\n      nonce: BigInt('0')\n    }\n  };\n  var defaultDelegateAccounts = fixtures_1.defaultAccounts().map(function (a, i) {\n    return fixtures_1.createDefaultAccount(modules, {\n      address: a.address,\n      dpos: {\n        delegate: {\n          username: \"delegate_\".concat(i)\n        }\n      }\n    });\n  });\n  var accounts = [faucetAccount].concat(_toConsumableArray(defaultDelegateAccounts));\n\n  var _create_genesis_block2 = create_genesis_block_1.createGenesisBlock({\n    modules: modules,\n    accounts: accounts\n  }),\n      genesisBlockJSON = _create_genesis_block2.genesisBlockJSON;\n\n  var appEnv = new ApplicationEnv(_objectSpread(_objectSpread({}, appEnvConfig), {}, {\n    modules: modules,\n    genesisBlockJSON: genesisBlockJSON\n  }));\n  return appEnv;\n};\n\nexports.createDefaultApplicationEnv = createDefaultApplicationEnv;","map":{"version":3,"sources":["../../src/testing/app_env.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAeA,IAAA,iBAAA,GAAA,OAAA,CAAA,yBAAA,CAAA;;AACA,IAAA,YAAA,GAAA,OAAA,CAAA,oBAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,MAAA,CAAA;;AAEA,IAAA,YAAA,GAAA,OAAA,CAAA,oBAAA,CAAA;;AACA,IAAA,IAAA,GAAA,OAAA,CAAA,IAAA,CAAA;;AACA,IAAA,UAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;AAGA,IAAA,UAAA,GAAA,OAAA,CAAA,YAAA,CAAA;;AAMA,IAAA,sBAAA,GAAA,OAAA,CAAA,wBAAA,CAAA;;AAEA,IAAA,aAAA,GAAA,OAAA,CAAA,gBAAA,CAAA;;AAEA,IAAA,SAAA,GAAA,OAAA,CAAA,YAAA,CAAA;;IASa,c;AAMZ,0BAAmB,SAAnB,EAAkD;AAAA;;AACjD,SAAK,gBAAL,CAAsB,SAAtB;AACA;;;;SAED,eAAsB;AACrB,aAAO,KAAK,YAAZ;AACA;;;SAED,eAAoB;AACnB,aAAO,KAAK,UAAZ;AACA;;;SAED,eAAmB;AAClB,aAAO,KAAK,SAAZ;AACA;;;SAED,eAA4B;AAC3B,aAAO,KAAK,YAAL,CAAkB,iBAAzB;AACA;;;SAED,eAAoB;AAEnB,aAAO,KAAK,YAAL,CAAkB,OAAlB,EAA2B,QAA3B,EAAqC,SAA5C;AACA;;;;uFAEM;AAAA;AAAA;AAAA;AAAA;AAEN,qBAAK,YAAL,CAAkB,eAAlB,IAAqC,KAAK,aAA1C;AAFM;AAAA,uBAGA,OAAO,CAAC,IAAR,CAAa,CAClB,KAAK,YAAL,CAAkB,GAAlB,EADkB,EAElB,IAAI,OAAJ,CAAY,UAAA,OAAO;AAAA,yBAAI,UAAU,CAAC,OAAD,EAAU,IAAV,CAAd;AAAA,iBAAnB,CAFkB,CAAb,CAHA;;AAAA;AAAA,sBAQF,KAAK,YAAL,CAAkB,MAAlB,CAAyB,GAAzB,CAA6B,MAA7B,IAAuC,KAAK,YAAL,CAAkB,MAAlB,CAAyB,GAAzB,CAA6B,IAA7B,KAAsC,KAR3E;AAAA;AAAA;AAAA;;AAAA;AAAA,uBASmB,iBAAA,CAAA,eAAA,CAAgB,KAAK,SAArB,CATnB;;AAAA;AASL,qBAAK,UATA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;sFAaA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsB,gBAAA,OAAtB,8DAAsD;AAAE,kBAAA,OAAO,EAAE;AAAX,iBAAtD;;AAAA,qBACF,OAAO,CAAC,OADN;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAGC,KAAK,YAAL,CAAkB,WAAlB,EAA+B,KAA/B,EAHD;;AAAA;AAAA;AAAA,uBAKC,KAAK,YAAL,CAAkB,eAAlB,EAAmC,KAAnC,EALD;;AAAA;AAAA;AAAA,uBAOC,KAAK,YAAL,CAAkB,SAAlB,EAA6B,KAA7B,EAPD;;AAAA;AAAA,sBASF,KAAK,YAAL,CAAkB,MAAlB,CAAyB,GAAzB,CAA6B,MAA7B,IAAuC,KAAK,YAAL,CAAkB,MAAlB,CAAyB,GAAzB,CAA6B,IAA7B,KAAsC,KAT3E;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAUC,KAAK,UAAL,CAAgB,UAAhB,EAVD;;AAAA;AAAA;AAAA,uBAYA,KAAK,YAAL,CAAkB,QAAlB,EAZA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;kFAeA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkB,gBAAA,CAAlB,8DAAsB,CAAtB;AAEA,gBAAA,MAFA,GAES,KAAK,SAAL,CAAe,MAAf,CAAsB,MAAtB,GAA+B,CAFxC;AAAA,kDAGC,IAAI,OAAJ,CAAY,UAAA,OAAO,EAAG;AAE5B,kBAAA,KAAI,CAAC,YAAL,CAAkB,UAAlB,EAA8B,SAA9B,CAAwC,eAAxC,EAAyD,YAAK;AAC7D,wBAAI,KAAI,CAAC,SAAL,CAAe,MAAf,CAAsB,MAAtB,IAAgC,MAApC,EAA4C;AAC3C,sBAAA,OAAO;AACP;AACD,mBAJD;AAKA,iBAPM,CAHD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;WAaC,0BAAiB,SAAjB,EAAgD;;;AAGvD,MAAA,YAAA,CAAA,KAAA,CAAM,UAAN;;AACA,kCAA6B,sBAAA,CAAA,kBAAA,CAAmB;AAAE,QAAA,OAAO,EAAE,SAAS,CAAC;AAArB,OAAnB,CAA7B;AAAA,UAAQ,gBAAR,yBAAQ,gBAAR;;AACA,WAAK,aAAL,GAAqB,CAAA,EAAA,GAAA,SAAS,CAAC,gBAAV,MAA0B,IAA1B,IAA0B,EAAA,KAAA,KAAA,CAA1B,GAA0B,EAA1B,GAA8B,gBAAnD;AAEA,UAAM,MAAM,GAAG,YAAA,CAAA,OAAA,CAAQ,SAAR,CAAkB,EAAlB,EAAsB,UAAA,CAAA,aAAtB,EAAqC,CAAA,EAAA,GAAA,SAAS,CAAC,MAAV,MAAgB,IAAhB,IAAgB,EAAA,KAAA,KAAA,CAAhB,GAAgB,EAAhB,GAAoB,EAAzD,CAAf;AACA,UAAQ,KAAR,GAAkB,MAAlB,CAAQ,KAAR;AAEA,UAAM,WAAW,GAAG,IAAI,aAAA,CAAA,WAAJ,CAAgB,KAAK,aAArB,EAAoC,MAApC,CAApB;AACA,MAAA,SAAS,CAAC,OAAV,CAAkB,GAAlB,CAAsB,UAAA,MAAM;AAAA,eAAI,WAAW,CAAC,cAAZ,CAA2B,MAA3B,CAAJ;AAAA,OAA5B;AACA,OAAA,EAAA,GAAA,SAAS,CAAC,OAAV,MAAiB,IAAjB,IAAiB,EAAA,KAAA,KAAA,CAAjB,GAAiB,KAAA,CAAjB,GAAiB,EAAA,CAAE,GAAF,CAAM,UAAA,MAAM;AAAA,eAAI,WAAW,CAAC,cAAZ,CAA2B,MAA3B,CAAJ;AAAA,OAAZ,CAAjB;AACA,WAAK,SAAL,GAAiB,MAAA,CAAA,IAAA,CAAK,WAAW,CAAC,MAAZ,CAAmB,QAAxB,EAAkC,KAAlC,CAAjB;AAEA,WAAK,YAAL,GAAoB,WAApB;AACA,aAAO,WAAP;AACA;;;;;;AAzFF,OAAA,CAAA,cAAA,GAAA,cAAA;;AA4FO,IAAM,2BAA2B,GAAG,SAA9B,2BAA8B,CAC1C,YAD0C,EAEvB;;;AACnB,MAAM,QAAQ,GAAG,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,YAAY,CAAC,MAAb,MAAmB,IAAnB,IAAmB,EAAA,KAAA,KAAA,CAAnB,GAAmB,KAAA,CAAnB,GAAmB,EAAA,CAAE,QAArB,MAA6B,IAA7B,IAA6B,EAAA,KAAA,KAAA,CAA7B,GAA6B,EAA7B,GAAiC,UAAA,CAAA,aAAA,CAAc,QAAhE;AACA,MAAM,KAAK,GAAG,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,YAAY,CAAC,MAAb,MAAmB,IAAnB,IAAmB,EAAA,KAAA,KAAA,CAAnB,GAAmB,KAAA,CAAnB,GAAmB,EAAA,CAAE,KAArB,MAA0B,IAA1B,IAA0B,EAAA,KAAA,KAAA,CAA1B,GAA0B,EAA1B,GAA8B,UAAA,CAAA,aAAA,CAAc,KAA1D;AAGA,MAAM,QAAQ,GAAG,MAAA,CAAA,IAAA,CAAK,QAAQ,CAAC,OAAT,CAAiB,GAAjB,EAAsB,IAAA,CAAA,OAAA,EAAtB,CAAL,EAAuC,KAAvC,CAAjB;;AACA,MAAI,UAAA,CAAA,UAAA,CAAW,QAAX,CAAJ,EAA0B;AACzB,IAAA,UAAA,CAAA,SAAA,CAAU,QAAV,EAAoB;AAAE,MAAA,SAAS,EAAE;AAAb,KAApB;AACA;;AAED,MAAM,cAAc,GAAG,CAAC,SAAA,CAAA,WAAD,EAAc,SAAA,CAAA,cAAd,EAA8B,SAAA,CAAA,UAA9B,EAA0C,SAAA,CAAA,UAA1C,CAAvB;;AACA,MAAM,OAAO,sBAAO,IAAI,GAAJ,8BAAa,CAAA,EAAA,GAAA,YAAY,CAAC,OAAb,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,EAApB,GAAwB,EAArC,GAA6C,cAA7C,EAAP,CAAb;;AAEA,MAAM,aAAa,GAAG;AACrB,IAAA,OAAO,EAAE,UAAA,CAAA,oBAAA,CAAqB,OADT;AAErB,IAAA,KAAK,EAAE;AAAE,MAAA,OAAO,EAAE,MAAM,CAAC,UAAA,CAAA,oBAAA,CAAqB,OAAtB;AAAjB,KAFc;AAGrB,IAAA,QAAQ,EAAE;AAAE,MAAA,KAAK,EAAE,MAAM,CAAC,GAAD;AAAf;AAHW,GAAtB;AAKA,MAAM,uBAAuB,GAAG,UAAA,CAAA,eAAA,GAAkB,GAAlB,CAAsB,UAAC,CAAD,EAAI,CAAJ;AAAA,WACrD,UAAA,CAAA,oBAAA,CAAqB,OAArB,EAA8B;AAC7B,MAAA,OAAO,EAAE,CAAC,CAAC,OADkB;AAE7B,MAAA,IAAI,EAAE;AACL,QAAA,QAAQ,EAAE;AACT,UAAA,QAAQ,qBAAc,CAAd;AADC;AADL;AAFuB,KAA9B,CADqD;AAAA,GAAtB,CAAhC;AAUA,MAAM,QAAQ,IAAI,aAAJ,4BAAsB,uBAAtB,EAAd;;AACA,+BAA6B,sBAAA,CAAA,kBAAA,CAAmB;AAC/C,IAAA,OAAO,EAAP,OAD+C;AAE/C,IAAA,QAAQ,EAAR;AAF+C,GAAnB,CAA7B;AAAA,MAAQ,gBAAR,0BAAQ,gBAAR;;AAKA,MAAM,MAAM,GAAG,IAAI,cAAJ,iCACX,YADW;AAEd,IAAA,OAAO,EAAP,OAFc;AAGd,IAAA,gBAAgB,EAAhB;AAHc,KAAf;AAMA,SAAO,MAAP;AACA,CA3CM;;AAAM,OAAA,CAAA,2BAAA,GAA2B,2BAA3B","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createDefaultApplicationEnv = exports.ApplicationEnv = void 0;\nconst lisk_api_client_1 = require(\"@liskhq/lisk-api-client\");\nconst lisk_codec_1 = require(\"@liskhq/lisk-codec\");\nconst path_1 = require(\"path\");\nconst lisk_utils_1 = require(\"@liskhq/lisk-utils\");\nconst os_1 = require(\"os\");\nconst fs_extra_1 = require(\"fs-extra\");\nconst fixtures_1 = require(\"./fixtures\");\nconst create_genesis_block_1 = require(\"./create_genesis_block\");\nconst application_1 = require(\"../application\");\nconst modules_1 = require(\"../modules\");\nclass ApplicationEnv {\n    constructor(appConfig) {\n        this._initApplication(appConfig);\n    }\n    get application() {\n        return this._application;\n    }\n    get ipcClient() {\n        return this._ipcClient;\n    }\n    get dataPath() {\n        return this._dataPath;\n    }\n    get networkIdentifier() {\n        return this._application.networkIdentifier;\n    }\n    get lastBlock() {\n        return this._application['_node']['_chain'].lastBlock;\n    }\n    async startApplication() {\n        this._application['_genesisBlock'] = this._genesisBlock;\n        await Promise.race([\n            this._application.run(),\n            new Promise(resolve => setTimeout(resolve, 3000)),\n        ]);\n        if (this._application.config.rpc.enable && this._application.config.rpc.mode === 'ipc') {\n            this._ipcClient = await lisk_api_client_1.createIPCClient(this._dataPath);\n        }\n    }\n    async stopApplication(options = { clearDB: true }) {\n        if (options.clearDB) {\n            await this._application['_forgerDB'].clear();\n            await this._application['_blockchainDB'].clear();\n            await this._application['_nodeDB'].clear();\n        }\n        if (this._application.config.rpc.enable && this._application.config.rpc.mode === 'ipc') {\n            await this._ipcClient.disconnect();\n        }\n        await this._application.shutdown();\n    }\n    async waitNBlocks(n = 1) {\n        const height = this.lastBlock.header.height + n;\n        return new Promise(resolve => {\n            this._application['_channel'].subscribe('app:block:new', () => {\n                if (this.lastBlock.header.height >= height) {\n                    resolve();\n                }\n            });\n        });\n    }\n    _initApplication(appConfig) {\n        var _a, _b, _c;\n        lisk_codec_1.codec.clearCache();\n        const { genesisBlockJSON } = create_genesis_block_1.createGenesisBlock({ modules: appConfig.modules });\n        this._genesisBlock = (_a = appConfig.genesisBlockJSON) !== null && _a !== void 0 ? _a : genesisBlockJSON;\n        const config = lisk_utils_1.objects.mergeDeep({}, fixtures_1.defaultConfig, (_b = appConfig.config) !== null && _b !== void 0 ? _b : {});\n        const { label } = config;\n        const application = new application_1.Application(this._genesisBlock, config);\n        appConfig.modules.map(module => application.registerModule(module));\n        (_c = appConfig.plugins) === null || _c === void 0 ? void 0 : _c.map(plugin => application.registerPlugin(plugin));\n        this._dataPath = path_1.join(application.config.rootPath, label);\n        this._application = application;\n        return application;\n    }\n}\nexports.ApplicationEnv = ApplicationEnv;\nconst createDefaultApplicationEnv = (appEnvConfig) => {\n    var _a, _b, _c, _d, _e;\n    const rootPath = (_b = (_a = appEnvConfig.config) === null || _a === void 0 ? void 0 : _a.rootPath) !== null && _b !== void 0 ? _b : fixtures_1.defaultConfig.rootPath;\n    const label = (_d = (_c = appEnvConfig.config) === null || _c === void 0 ? void 0 : _c.label) !== null && _d !== void 0 ? _d : fixtures_1.defaultConfig.label;\n    const dataPath = path_1.join(rootPath.replace('~', os_1.homedir()), label);\n    if (fs_extra_1.existsSync(dataPath)) {\n        fs_extra_1.rmdirSync(dataPath, { recursive: true });\n    }\n    const defaultModules = [modules_1.TokenModule, modules_1.SequenceModule, modules_1.KeysModule, modules_1.DPoSModule];\n    const modules = [...new Set([...((_e = appEnvConfig.modules) !== null && _e !== void 0 ? _e : []), ...defaultModules])];\n    const faucetAccount = {\n        address: fixtures_1.defaultFaucetAccount.address,\n        token: { balance: BigInt(fixtures_1.defaultFaucetAccount.balance) },\n        sequence: { nonce: BigInt('0') },\n    };\n    const defaultDelegateAccounts = fixtures_1.defaultAccounts().map((a, i) => fixtures_1.createDefaultAccount(modules, {\n        address: a.address,\n        dpos: {\n            delegate: {\n                username: `delegate_${i}`,\n            },\n        },\n    }));\n    const accounts = [faucetAccount, ...defaultDelegateAccounts];\n    const { genesisBlockJSON } = create_genesis_block_1.createGenesisBlock({\n        modules,\n        accounts,\n    });\n    const appEnv = new ApplicationEnv({\n        ...appEnvConfig,\n        modules,\n        genesisBlockJSON,\n    });\n    return appEnv;\n};\nexports.createDefaultApplicationEnv = createDefaultApplicationEnv;\n//# sourceMappingURL=app_env.js.map"]},"metadata":{},"sourceType":"script"}