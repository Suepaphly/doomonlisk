{"ast":null,"code":"/**\n * Copyright 2021 Trent Mick.\n * Copyright 2020 Joyent Inc.\n *\n * The bunyan logging library for node.js.\n *\n * -*- mode: js -*-\n * vim: expandtab:ts=4:sw=4\n */\nvar VERSION = '1.8.15';\n/*\n * Bunyan log format version. This becomes the 'v' field on all log records.\n * This will be incremented if there is any backward incompatible change to\n * the log record format. Details will be in 'CHANGES.md' (the change log).\n */\n\nvar LOG_VERSION = 0;\n\nvar xxx = function xxx(s) {\n  // internal dev/debug logging\n  var args = ['XX' + 'X: ' + s].concat(Array.prototype.slice.call(arguments, 1));\n  console.error.apply(this, args);\n};\n\nvar xxx = function xxx() {}; // comment out to turn on debug logging\n\n/*\n * Runtime environment notes:\n *\n * Bunyan is intended to run in a number of runtime environments. Here are\n * some notes on differences for those envs and how the code copes.\n *\n * - node.js: The primary target environment.\n * - NW.js: http://nwjs.io/  An *app* environment that feels like both a\n *   node env -- it has node-like globals (`process`, `global`) and\n *   browser-like globals (`window`, `navigator`). My *understanding* is that\n *   bunyan can operate as if this is vanilla node.js.\n * - browser: Failing the above, we sniff using the `window` global\n *   <https://developer.mozilla.org/en-US/docs/Web/API/Window/window>.\n *      - browserify: http://browserify.org/  A browser-targetting bundler of\n *        node.js deps. The runtime is a browser env, so can't use fs access,\n *        etc. Browserify's build looks for `require(<single-string>)` imports\n *        to bundle. For some imports it won't be able to handle, we \"hide\"\n *        from browserify with `require('frobshizzle' + '')`.\n * - Other? Please open issues if things are broken.\n */\n\n\nvar runtimeEnv;\n\nif (typeof process !== 'undefined' && process.versions) {\n  if (process.versions.nw) {\n    runtimeEnv = 'nw';\n  } else if (process.versions.node) {\n    runtimeEnv = 'node';\n  }\n}\n\nif (!runtimeEnv && typeof window !== 'undefined' && window.window === window) {\n  runtimeEnv = 'browser';\n}\n\nif (!runtimeEnv) {\n  throw new Error('unknown runtime environment');\n}\n\nvar os, fs, dtrace;\n\nif (runtimeEnv === 'browser') {\n  os = {\n    hostname: function hostname() {\n      return window.location.host;\n    }\n  };\n  fs = {};\n  dtrace = null;\n} else {\n  os = require('os');\n  fs = require('fs');\n\n  try {\n    dtrace = require('dtrace-provider' + '');\n  } catch (e) {\n    dtrace = null;\n  }\n}\n\nvar util = require('util');\n\nvar assert = require('assert');\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar stream = require('stream');\n\ntry {\n  var safeJsonStringify = require('safe-json-stringify');\n} catch (e) {\n  safeJsonStringify = null;\n}\n\nif (process.env.BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY) {\n  safeJsonStringify = null;\n} // The 'mv' module is required for rotating-file stream support.\n\n\ntry {\n  var mv = require('mv' + '');\n} catch (e) {\n  mv = null;\n}\n\ntry {\n  var sourceMapSupport = require('source-map-support' + '');\n} catch (_) {\n  sourceMapSupport = null;\n} //---- Internal support stuff\n\n/**\n * A shallow copy of an object. Bunyan logging attempts to never cause\n * exceptions, so this function attempts to handle non-objects gracefully.\n */\n\n\nfunction objCopy(obj) {\n  if (obj == null) {\n    // null or undefined\n    return obj;\n  } else if (Array.isArray(obj)) {\n    return obj.slice();\n  } else if (typeof obj === 'object') {\n    var copy = {};\n    Object.keys(obj).forEach(function (k) {\n      copy[k] = obj[k];\n    });\n    return copy;\n  } else {\n    return obj;\n  }\n}\n\nvar format = util.format;\n\nif (!format) {\n  // If node < 0.6, then use its `util.format`:\n  // <https://github.com/joyent/node/blob/master/lib/util.js#L22>:\n  var inspect = util.inspect;\n  var formatRegExp = /%[sdj%]/g;\n\n  format = function format(f) {\n    if (typeof f !== 'string') {\n      var objects = [];\n\n      for (var i = 0; i < arguments.length; i++) {\n        objects.push(inspect(arguments[i]));\n      }\n\n      return objects.join(' ');\n    }\n\n    var i = 1;\n    var args = arguments;\n    var len = args.length;\n    var str = String(f).replace(formatRegExp, function (x) {\n      if (i >= len) return x;\n\n      switch (x) {\n        case '%s':\n          return String(args[i++]);\n\n        case '%d':\n          return Number(args[i++]);\n\n        case '%j':\n          return fastAndSafeJsonStringify(args[i++]);\n\n        case '%%':\n          return '%';\n\n        default:\n          return x;\n      }\n    });\n\n    for (var x = args[i]; i < len; x = args[++i]) {\n      if (x === null || typeof x !== 'object') {\n        str += ' ' + x;\n      } else {\n        str += ' ' + inspect(x);\n      }\n    }\n\n    return str;\n  };\n}\n/**\n * Gather some caller info 3 stack levels up.\n * See <http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi>.\n */\n\n\nfunction getCaller3Info() {\n  if (this === undefined) {\n    // Cannot access caller info in 'strict' mode.\n    return;\n  }\n\n  var obj = {};\n  var saveLimit = Error.stackTraceLimit;\n  var savePrepare = Error.prepareStackTrace;\n  Error.stackTraceLimit = 3;\n\n  Error.prepareStackTrace = function (_, stack) {\n    var caller = stack[2];\n\n    if (sourceMapSupport) {\n      caller = sourceMapSupport.wrapCallSite(caller);\n    }\n\n    obj.file = caller.getFileName();\n    obj.line = caller.getLineNumber();\n    var func = caller.getFunctionName();\n    if (func) obj.func = func;\n  };\n\n  Error.captureStackTrace(this, getCaller3Info);\n  this.stack;\n  Error.stackTraceLimit = saveLimit;\n  Error.prepareStackTrace = savePrepare;\n  return obj;\n}\n\nfunction _indent(s, indent) {\n  if (!indent) indent = '    ';\n  var lines = s.split(/\\r?\\n/g);\n  return indent + lines.join('\\n' + indent);\n}\n/**\n * Warn about an bunyan processing error.\n *\n * @param msg {String} Message with which to warn.\n * @param dedupKey {String} Optional. A short string key for this warning to\n *      have its warning only printed once.\n */\n\n\nfunction _warn(msg, dedupKey) {\n  assert.ok(msg);\n\n  if (dedupKey) {\n    if (_warned[dedupKey]) {\n      return;\n    }\n\n    _warned[dedupKey] = true;\n  }\n\n  process.stderr.write(msg + '\\n');\n}\n\nfunction _haveWarned(dedupKey) {\n  return _warned[dedupKey];\n}\n\nvar _warned = {};\n\nfunction ConsoleRawStream() {}\n\nConsoleRawStream.prototype.write = function (rec) {\n  if (rec.level < INFO) {\n    console.log(rec);\n  } else if (rec.level < WARN) {\n    console.info(rec);\n  } else if (rec.level < ERROR) {\n    console.warn(rec);\n  } else {\n    console.error(rec);\n  }\n}; //---- Levels\n\n\nvar TRACE = 10;\nvar DEBUG = 20;\nvar INFO = 30;\nvar WARN = 40;\nvar ERROR = 50;\nvar FATAL = 60;\nvar levelFromName = {\n  'trace': TRACE,\n  'debug': DEBUG,\n  'info': INFO,\n  'warn': WARN,\n  'error': ERROR,\n  'fatal': FATAL\n};\nvar nameFromLevel = {};\nObject.keys(levelFromName).forEach(function (name) {\n  nameFromLevel[levelFromName[name]] = name;\n}); // Dtrace probes.\n\nvar dtp = undefined;\nvar probes = dtrace && {};\n/**\n * Resolve a level number, name (upper or lowercase) to a level number value.\n *\n * @param nameOrNum {String|Number} A level name (case-insensitive) or positive\n *      integer level.\n * @api public\n */\n\nfunction resolveLevel(nameOrNum) {\n  var level;\n  var type = typeof nameOrNum;\n\n  if (type === 'string') {\n    level = levelFromName[nameOrNum.toLowerCase()];\n\n    if (!level) {\n      throw new Error(format('unknown level name: \"%s\"', nameOrNum));\n    }\n  } else if (type !== 'number') {\n    throw new TypeError(format('cannot resolve level: invalid arg (%s):', type, nameOrNum));\n  } else if (nameOrNum < 0 || Math.floor(nameOrNum) !== nameOrNum) {\n    throw new TypeError(format('level is not a positive integer: %s', nameOrNum));\n  } else {\n    level = nameOrNum;\n  }\n\n  return level;\n}\n\nfunction isWritable(obj) {\n  if (obj instanceof stream.Writable) {\n    return true;\n  }\n\n  return typeof obj.write === 'function';\n} //---- Logger class\n\n/**\n * Create a Logger instance.\n *\n * @param options {Object} See documentation for full details. At minimum\n *    this must include a 'name' string key. Configuration keys:\n *      - `streams`: specify the logger output streams. This is an array of\n *        objects with these fields:\n *          - `type`: The stream type. See README.md for full details.\n *            Often this is implied by the other fields. Examples are\n *            'file', 'stream' and \"raw\".\n *          - `level`: Defaults to 'info'.\n *          - `path` or `stream`: The specify the file path or writeable\n *            stream to which log records are written. E.g.\n *            `stream: process.stdout`.\n *          - `closeOnExit` (boolean): Optional. Default is true for a\n *            'file' stream when `path` is given, false otherwise.\n *        See README.md for full details.\n *      - `level`: set the level for a single output stream (cannot be used\n *        with `streams`)\n *      - `stream`: the output stream for a logger with just one, e.g.\n *        `process.stdout` (cannot be used with `streams`)\n *      - `serializers`: object mapping log record field names to\n *        serializing functions. See README.md for details.\n *      - `src`: Boolean (default false). Set true to enable 'src' automatic\n *        field with log call source info.\n *    All other keys are log record fields.\n *\n * An alternative *internal* call signature is used for creating a child:\n *    new Logger(<parent logger>, <child options>[, <child opts are simple>]);\n *\n * @param _childSimple (Boolean) An assertion that the given `_childOptions`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation.\n */\n\n\nfunction Logger(options, _childOptions, _childSimple) {\n  xxx('Logger start:', options);\n\n  if (!(this instanceof Logger)) {\n    return new Logger(options, _childOptions);\n  } // Input arg validation.\n\n\n  var parent;\n\n  if (_childOptions !== undefined) {\n    parent = options;\n    options = _childOptions;\n\n    if (!(parent instanceof Logger)) {\n      throw new TypeError('invalid Logger creation: do not pass a second arg');\n    }\n  }\n\n  if (!options) {\n    throw new TypeError('options (object) is required');\n  }\n\n  if (!parent) {\n    if (!options.name) {\n      throw new TypeError('options.name (string) is required');\n    }\n  } else {\n    if (options.name) {\n      throw new TypeError('invalid options.name: child cannot set logger name');\n    }\n  }\n\n  if (options.stream && options.streams) {\n    throw new TypeError('cannot mix \"streams\" and \"stream\" options');\n  }\n\n  if (options.streams && !Array.isArray(options.streams)) {\n    throw new TypeError('invalid options.streams: must be an array');\n  }\n\n  if (options.serializers && (typeof options.serializers !== 'object' || Array.isArray(options.serializers))) {\n    throw new TypeError('invalid options.serializers: must be an object');\n  }\n\n  EventEmitter.call(this); // Fast path for simple child creation.\n\n  if (parent && _childSimple) {\n    // `_isSimpleChild` is a signal to stream close handling that this child\n    // owns none of its streams.\n    this._isSimpleChild = true;\n    this._level = parent._level;\n    this.streams = parent.streams;\n    this.serializers = parent.serializers;\n    this.src = parent.src;\n    var fields = this.fields = {};\n    var parentFieldNames = Object.keys(parent.fields);\n\n    for (var i = 0; i < parentFieldNames.length; i++) {\n      var name = parentFieldNames[i];\n      fields[name] = parent.fields[name];\n    }\n\n    var names = Object.keys(options);\n\n    for (var i = 0; i < names.length; i++) {\n      var name = names[i];\n      fields[name] = options[name];\n    }\n\n    return;\n  } // Start values.\n\n\n  var self = this;\n\n  if (parent) {\n    this._level = parent._level;\n    this.streams = [];\n\n    for (var i = 0; i < parent.streams.length; i++) {\n      var s = objCopy(parent.streams[i]);\n      s.closeOnExit = false; // Don't own parent stream.\n\n      this.streams.push(s);\n    }\n\n    this.serializers = objCopy(parent.serializers);\n    this.src = parent.src;\n    this.fields = objCopy(parent.fields);\n\n    if (options.level) {\n      this.level(options.level);\n    }\n  } else {\n    this._level = Number.POSITIVE_INFINITY;\n    this.streams = [];\n    this.serializers = null;\n    this.src = false;\n    this.fields = {};\n  }\n\n  if (!dtp && dtrace) {\n    dtp = dtrace.createDTraceProvider('bunyan');\n\n    for (var level in levelFromName) {\n      var probe;\n      probes[levelFromName[level]] = probe = dtp.addProbe('log-' + level, 'char *'); // Explicitly add a reference to dtp to prevent it from being GC'd\n\n      probe.dtp = dtp;\n    }\n\n    dtp.enable();\n  } // Handle *config* options (i.e. options that are not just plain data\n  // for log records).\n\n\n  if (options.stream) {\n    self.addStream({\n      type: 'stream',\n      stream: options.stream,\n      closeOnExit: false,\n      level: options.level\n    });\n  } else if (options.streams) {\n    options.streams.forEach(function (s) {\n      self.addStream(s, options.level);\n    });\n  } else if (parent && options.level) {\n    this.level(options.level);\n  } else if (!parent) {\n    if (runtimeEnv === 'browser') {\n      /*\n       * In the browser we'll be emitting to console.log by default.\n       * Any console.log worth its salt these days can nicely render\n       * and introspect objects (e.g. the Firefox and Chrome console)\n       * so let's emit the raw log record. Are there browsers for which\n       * that breaks things?\n       */\n      self.addStream({\n        type: 'raw',\n        stream: new ConsoleRawStream(),\n        closeOnExit: false,\n        level: options.level\n      });\n    } else {\n      self.addStream({\n        type: 'stream',\n        stream: process.stdout,\n        closeOnExit: false,\n        level: options.level\n      });\n    }\n  }\n\n  if (options.serializers) {\n    self.addSerializers(options.serializers);\n  }\n\n  if (options.src) {\n    this.src = true;\n  }\n\n  xxx('Logger: ', self); // Fields.\n  // These are the default fields for log records (minus the attributes\n  // removed in this constructor). To allow storing raw log records\n  // (unrendered), `this.fields` must never be mutated. Create a copy for\n  // any changes.\n\n  var fields = objCopy(options);\n  delete fields.stream;\n  delete fields.level;\n  delete fields.streams;\n  delete fields.serializers;\n  delete fields.src;\n\n  if (this.serializers) {\n    this._applySerializers(fields);\n  }\n\n  if (!fields.hostname && !self.fields.hostname) {\n    fields.hostname = os.hostname();\n  }\n\n  if (!fields.pid) {\n    fields.pid = process.pid;\n  }\n\n  Object.keys(fields).forEach(function (k) {\n    self.fields[k] = fields[k];\n  });\n}\n\nutil.inherits(Logger, EventEmitter);\n/**\n * Add a stream\n *\n * @param stream {Object}. Object with these fields:\n *    - `type`: The stream type. See README.md for full details.\n *      Often this is implied by the other fields. Examples are\n *      'file', 'stream' and \"raw\".\n *    - `path` or `stream`: The specify the file path or writeable\n *      stream to which log records are written. E.g.\n *      `stream: process.stdout`.\n *    - `level`: Optional. Falls back to `defaultLevel`.\n *    - `closeOnExit` (boolean): Optional. Default is true for a\n *      'file' stream when `path` is given, false otherwise.\n *    See README.md for full details.\n * @param defaultLevel {Number|String} Optional. A level to use if\n *      `stream.level` is not set. If neither is given, this defaults to INFO.\n */\n\nLogger.prototype.addStream = function addStream(s, defaultLevel) {\n  var self = this;\n\n  if (defaultLevel === null || defaultLevel === undefined) {\n    defaultLevel = INFO;\n  }\n\n  s = objCopy(s); // Implicit 'type' from other args.\n\n  if (!s.type) {\n    if (s.stream) {\n      s.type = 'stream';\n    } else if (s.path) {\n      s.type = 'file';\n    }\n  }\n\n  s.raw = s.type === 'raw'; // PERF: Allow for faster check in `_emit`.\n\n  if (s.level !== undefined) {\n    s.level = resolveLevel(s.level);\n  } else {\n    s.level = resolveLevel(defaultLevel);\n  }\n\n  if (s.level < self._level) {\n    self._level = s.level;\n  }\n\n  switch (s.type) {\n    case 'stream':\n      assert.ok(isWritable(s.stream), '\"stream\" stream is not writable: ' + util.inspect(s.stream));\n\n      if (!s.closeOnExit) {\n        s.closeOnExit = false;\n      }\n\n      break;\n\n    case 'file':\n      if (s.reemitErrorEvents === undefined) {\n        s.reemitErrorEvents = true;\n      }\n\n      if (!s.stream) {\n        s.stream = fs.createWriteStream(s.path, {\n          flags: 'a',\n          encoding: 'utf8'\n        });\n\n        if (!s.closeOnExit) {\n          s.closeOnExit = true;\n        }\n      } else {\n        if (!s.closeOnExit) {\n          s.closeOnExit = false;\n        }\n      }\n\n      break;\n\n    case 'rotating-file':\n      assert.ok(!s.stream, '\"rotating-file\" stream should not give a \"stream\"');\n      assert.ok(s.path);\n      assert.ok(mv, '\"rotating-file\" stream type is not supported: ' + 'missing \"mv\" module');\n      s.stream = new RotatingFileStream(s);\n\n      if (!s.closeOnExit) {\n        s.closeOnExit = true;\n      }\n\n      break;\n\n    case 'raw':\n      if (!s.closeOnExit) {\n        s.closeOnExit = false;\n      }\n\n      break;\n\n    default:\n      throw new TypeError('unknown stream type \"' + s.type + '\"');\n  }\n\n  if (s.reemitErrorEvents && typeof s.stream.on === 'function') {\n    // TODO: When we have `<logger>.close()`, it should remove event\n    //      listeners to not leak Logger instances.\n    s.stream.on('error', function onStreamError(err) {\n      self.emit('error', err, s);\n    });\n  }\n\n  self.streams.push(s);\n  delete self.haveNonRawStreams; // reset\n};\n/**\n * Add serializers\n *\n * @param serializers {Object} Optional. Object mapping log record field names\n *    to serializing functions. See README.md for details.\n */\n\n\nLogger.prototype.addSerializers = function addSerializers(serializers) {\n  var self = this;\n\n  if (!self.serializers) {\n    self.serializers = {};\n  }\n\n  Object.keys(serializers).forEach(function (field) {\n    var serializer = serializers[field];\n\n    if (typeof serializer !== 'function') {\n      throw new TypeError(format('invalid serializer for \"%s\" field: must be a function', field));\n    } else {\n      self.serializers[field] = serializer;\n    }\n  });\n};\n/**\n * Create a child logger, typically to add a few log record fields.\n *\n * This can be useful when passing a logger to a sub-component, e.g. a\n * 'wuzzle' component of your service:\n *\n *    var wuzzleLog = log.child({component: 'wuzzle'})\n *    var wuzzle = new Wuzzle({..., log: wuzzleLog})\n *\n * Then log records from the wuzzle code will have the same structure as\n * the app log, *plus the component='wuzzle' field*.\n *\n * @param options {Object} Optional. Set of options to apply to the child.\n *    All of the same options for a new Logger apply here. Notes:\n *      - The parent's streams are inherited and cannot be removed in this\n *        call. Any given `streams` are *added* to the set inherited from\n *        the parent.\n *      - The parent's serializers are inherited, though can effectively be\n *        overwritten by using duplicate keys.\n *      - Can use `level` to set the level of the streams inherited from\n *        the parent. The level for the parent is NOT affected.\n * @param simple {Boolean} Optional. Set to true to assert that `options`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation. See 'tools/timechild.js' for numbers.\n */\n\n\nLogger.prototype.child = function (options, simple) {\n  return new this.constructor(this, options || {}, simple);\n};\n/**\n * A convenience method to reopen 'file' streams on a logger. This can be\n * useful with external log rotation utilities that move and re-open log files\n * (e.g. logrotate on Linux, logadm on SmartOS/Illumos). Those utilities\n * typically have rotation options to copy-and-truncate the log file, but\n * you may not want to use that. An alternative is to do this in your\n * application:\n *\n *      var log = bunyan.createLogger(...);\n *      ...\n *      process.on('SIGUSR2', function () {\n *          log.reopenFileStreams();\n *      });\n *      ...\n *\n * See <https://github.com/trentm/node-bunyan/issues/104>.\n */\n\n\nLogger.prototype.reopenFileStreams = function () {\n  var self = this;\n  self.streams.forEach(function (s) {\n    if (s.type === 'file') {\n      if (s.stream) {\n        // Not sure if typically would want this, or more immediate\n        // `s.stream.destroy()`.\n        s.stream.end();\n        s.stream.destroySoon();\n        delete s.stream;\n      }\n\n      s.stream = fs.createWriteStream(s.path, {\n        flags: 'a',\n        encoding: 'utf8'\n      });\n      s.stream.on('error', function (err) {\n        self.emit('error', err, s);\n      });\n    }\n  });\n};\n/* BEGIN JSSTYLED */\n\n/**\n * Close this logger.\n *\n * This closes streams (that it owns, as per 'endOnClose' attributes on\n * streams), etc. Typically you **don't** need to bother calling this.\nLogger.prototype.close = function () {\n    if (this._closed) {\n        return;\n    }\n    if (!this._isSimpleChild) {\n        self.streams.forEach(function (s) {\n            if (s.endOnClose) {\n                xxx('closing stream s:', s);\n                s.stream.end();\n                s.endOnClose = false;\n            }\n        });\n    }\n    this._closed = true;\n}\n */\n\n/* END JSSTYLED */\n\n/**\n * Get/set the level of all streams on this logger.\n *\n * Get Usage:\n *    // Returns the current log level (lowest level of all its streams).\n *    log.level() -> INFO\n *\n * Set Usage:\n *    log.level(INFO)       // set all streams to level INFO\n *    log.level('info')     // can use 'info' et al aliases\n */\n\n\nLogger.prototype.level = function level(value) {\n  if (value === undefined) {\n    return this._level;\n  }\n\n  var newLevel = resolveLevel(value);\n  var len = this.streams.length;\n\n  for (var i = 0; i < len; i++) {\n    this.streams[i].level = newLevel;\n  }\n\n  this._level = newLevel;\n};\n/**\n * Get/set the level of a particular stream on this logger.\n *\n * Get Usage:\n *    // Returns an array of the levels of each stream.\n *    log.levels() -> [TRACE, INFO]\n *\n *    // Returns a level of the identified stream.\n *    log.levels(0) -> TRACE      // level of stream at index 0\n *    log.levels('foo')           // level of stream with name 'foo'\n *\n * Set Usage:\n *    log.levels(0, INFO)         // set level of stream 0 to INFO\n *    log.levels(0, 'info')       // can use 'info' et al aliases\n *    log.levels('foo', WARN)     // set stream named 'foo' to WARN\n *\n * Stream names: When streams are defined, they can optionally be given\n * a name. For example,\n *       log = new Logger({\n *         streams: [\n *           {\n *             name: 'foo',\n *             path: '/var/log/my-service/foo.log'\n *             level: 'trace'\n *           },\n *         ...\n *\n * @param name {String|Number} The stream index or name.\n * @param value {Number|String} The level value (INFO) or alias ('info').\n *    If not given, this is a 'get' operation.\n * @throws {Error} If there is no stream with the given name.\n */\n\n\nLogger.prototype.levels = function levels(name, value) {\n  if (name === undefined) {\n    assert.equal(value, undefined);\n    return this.streams.map(function (s) {\n      return s.level;\n    });\n  }\n\n  var stream;\n\n  if (typeof name === 'number') {\n    stream = this.streams[name];\n\n    if (stream === undefined) {\n      throw new Error('invalid stream index: ' + name);\n    }\n  } else {\n    var len = this.streams.length;\n\n    for (var i = 0; i < len; i++) {\n      var s = this.streams[i];\n\n      if (s.name === name) {\n        stream = s;\n        break;\n      }\n    }\n\n    if (!stream) {\n      throw new Error(format('no stream with name \"%s\"', name));\n    }\n  }\n\n  if (value === undefined) {\n    return stream.level;\n  } else {\n    var newLevel = resolveLevel(value);\n    stream.level = newLevel;\n\n    if (newLevel < this._level) {\n      this._level = newLevel;\n    }\n  }\n};\n/**\n * Apply registered serializers to the appropriate keys in the given fields.\n *\n * Pre-condition: This is only called if there is at least one serializer.\n *\n * @param fields (Object) The log record fields.\n * @param excludeFields (Object) Optional mapping of keys to `true` for\n *    keys to NOT apply a serializer.\n */\n\n\nLogger.prototype._applySerializers = function (fields, excludeFields) {\n  var self = this;\n  xxx('_applySerializers: excludeFields', excludeFields); // Check each serializer against these (presuming number of serializers\n  // is typically less than number of fields).\n\n  Object.keys(this.serializers).forEach(function (name) {\n    if (fields[name] === undefined || excludeFields && excludeFields[name]) {\n      return;\n    }\n\n    xxx('_applySerializers; apply to \"%s\" key', name);\n\n    try {\n      fields[name] = self.serializers[name](fields[name]);\n    } catch (err) {\n      _warn(format('bunyan: ERROR: Exception thrown from the \"%s\" ' + 'Bunyan serializer. This should never happen. This is a bug ' + 'in that serializer function.\\n%s', name, err.stack || err));\n\n      fields[name] = format('(Error in Bunyan log \"%s\" serializer ' + 'broke field. See stderr for details.)', name);\n    }\n  });\n};\n/**\n * Emit a log record.\n *\n * @param rec {log record}\n * @param noemit {Boolean} Optional. Set to true to skip emission\n *      and just return the JSON string.\n */\n\n\nLogger.prototype._emit = function (rec, noemit) {\n  var i; // Lazily determine if this Logger has non-'raw' streams. If there are\n  // any, then we need to stringify the log record.\n\n  if (this.haveNonRawStreams === undefined) {\n    this.haveNonRawStreams = false;\n\n    for (i = 0; i < this.streams.length; i++) {\n      if (!this.streams[i].raw) {\n        this.haveNonRawStreams = true;\n        break;\n      }\n    }\n  } // Stringify the object (creates a warning str on error).\n\n\n  var str;\n\n  if (noemit || this.haveNonRawStreams) {\n    str = fastAndSafeJsonStringify(rec) + os.EOL;\n  }\n\n  if (noemit) return str;\n  var level = rec.level;\n\n  for (i = 0; i < this.streams.length; i++) {\n    var s = this.streams[i];\n\n    if (s.level <= level) {\n      xxx('writing log rec \"%s\" to \"%s\" stream (%d <= %d): %j', rec.msg, s.type, s.level, level, rec);\n      s.stream.write(s.raw ? rec : str);\n    }\n  }\n\n  ;\n  return str;\n};\n/**\n * Build a record object suitable for emitting from the arguments\n * provided to the a log emitter.\n */\n\n\nfunction mkRecord(log, minLevel, args) {\n  var excludeFields, fields, msgArgs;\n\n  if (args[0] instanceof Error) {\n    // `log.<level>(err, ...)`\n    fields = {\n      // Use this Logger's err serializer, if defined.\n      err: log.serializers && log.serializers.err ? log.serializers.err(args[0]) : Logger.stdSerializers.err(args[0])\n    };\n    excludeFields = {\n      err: true\n    };\n\n    if (args.length === 1) {\n      msgArgs = [fields.err.message];\n    } else {\n      msgArgs = args.slice(1);\n    }\n  } else if (typeof args[0] !== 'object' || Array.isArray(args[0])) {\n    // `log.<level>(msg, ...)`\n    fields = null;\n    msgArgs = args.slice();\n  } else if (Buffer.isBuffer(args[0])) {\n    // `log.<level>(buf, ...)`\n    // Almost certainly an error, show `inspect(buf)`. See bunyan\n    // issue #35.\n    fields = null;\n    msgArgs = args.slice();\n    msgArgs[0] = util.inspect(msgArgs[0]);\n  } else {\n    // `log.<level>(fields, msg, ...)`\n    fields = args[0];\n\n    if (fields && args.length === 1 && fields.err && fields.err instanceof Error) {\n      msgArgs = [fields.err.message];\n    } else {\n      msgArgs = args.slice(1);\n    }\n  } // Build up the record object.\n\n\n  var rec = objCopy(log.fields);\n  var level = rec.level = minLevel;\n  var recFields = fields ? objCopy(fields) : null;\n\n  if (recFields) {\n    if (log.serializers) {\n      log._applySerializers(recFields, excludeFields);\n    }\n\n    Object.keys(recFields).forEach(function (k) {\n      rec[k] = recFields[k];\n    });\n  }\n\n  rec.msg = format.apply(log, msgArgs);\n\n  if (!rec.time) {\n    rec.time = new Date();\n  } // Get call source info\n\n\n  if (log.src && !rec.src) {\n    rec.src = getCaller3Info();\n  }\n\n  rec.v = LOG_VERSION;\n  return rec;\n}\n\n;\n/**\n * Build an array that dtrace-provider can use to fire a USDT probe. If we've\n * already built the appropriate string, we use it. Otherwise, build the\n * record object and stringify it.\n */\n\nfunction mkProbeArgs(str, log, minLevel, msgArgs) {\n  return [str || log._emit(mkRecord(log, minLevel, msgArgs), true)];\n}\n/**\n * Build a log emitter function for level minLevel. I.e. this is the\n * creator of `log.info`, `log.error`, etc.\n */\n\n\nfunction mkLogEmitter(minLevel) {\n  return function () {\n    var log = this;\n    var str = null;\n    var rec = null;\n\n    if (!this._emit) {\n      /*\n       * Show this invalid Bunyan usage warning *once*.\n       *\n       * See <https://github.com/trentm/node-bunyan/issues/100> for\n       * an example of how this can happen.\n       */\n      var dedupKey = 'unbound';\n\n      if (!_haveWarned[dedupKey]) {\n        var caller = getCaller3Info();\n\n        _warn(format('bunyan usage error: %s:%s: attempt to log ' + 'with an unbound log method: `this` is: %s', caller.file, caller.line, util.inspect(this)), dedupKey);\n      }\n\n      return;\n    } else if (arguments.length === 0) {\n      // `log.<level>()`\n      return this._level <= minLevel;\n    }\n\n    var msgArgs = new Array(arguments.length);\n\n    for (var i = 0; i < msgArgs.length; ++i) {\n      msgArgs[i] = arguments[i];\n    }\n\n    if (this._level <= minLevel) {\n      rec = mkRecord(log, minLevel, msgArgs);\n      str = this._emit(rec);\n    }\n\n    if (probes) {\n      probes[minLevel].fire(mkProbeArgs, str, log, minLevel, msgArgs);\n    }\n  };\n}\n/**\n * The functions below log a record at a specific level.\n *\n * Usages:\n *    log.<level>()  -> boolean is-trace-enabled\n *    log.<level>(<Error> err, [<string> msg, ...])\n *    log.<level>(<string> msg, ...)\n *    log.<level>(<object> fields, <string> msg, ...)\n *\n * where <level> is the lowercase version of the log level. E.g.:\n *\n *    log.info()\n *\n * @params fields {Object} Optional set of additional fields to log.\n * @params msg {String} Log message. This can be followed by additional\n *    arguments that are handled like\n *    [util.format](http://nodejs.org/docs/latest/api/all.html#util.format).\n */\n\n\nLogger.prototype.trace = mkLogEmitter(TRACE);\nLogger.prototype.debug = mkLogEmitter(DEBUG);\nLogger.prototype.info = mkLogEmitter(INFO);\nLogger.prototype.warn = mkLogEmitter(WARN);\nLogger.prototype.error = mkLogEmitter(ERROR);\nLogger.prototype.fatal = mkLogEmitter(FATAL); //---- Standard serializers\n// A serializer is a function that serializes a JavaScript object to a\n// JSON representation for logging. There is a standard set of presumed\n// interesting objects in node.js-land.\n\nLogger.stdSerializers = {}; // Serialize an HTTP request.\n\nLogger.stdSerializers.req = function (req) {\n  if (!req || !req.connection) return req;\n  return {\n    method: req.method,\n    // Accept `req.originalUrl` for expressjs usage.\n    // https://expressjs.com/en/api.html#req.originalUrl\n    url: req.originalUrl || req.url,\n    headers: req.headers,\n    remoteAddress: req.connection.remoteAddress,\n    remotePort: req.connection.remotePort\n  }; // Trailers: Skipping for speed. If you need trailers in your app, then\n  // make a custom serializer.\n  //if (Object.keys(trailers).length > 0) {\n  //  obj.trailers = req.trailers;\n  //}\n}; // Serialize an HTTP response.\n\n\nLogger.stdSerializers.res = function (res) {\n  if (!res || !res.statusCode) return res;\n  return {\n    statusCode: res.statusCode,\n    header: res._header\n  };\n};\n/*\n * This function dumps long stack traces for exceptions having a cause()\n * method. The error classes from\n * [verror](https://github.com/davepacheco/node-verror) and\n * [restify v2.0](https://github.com/mcavage/node-restify) are examples.\n *\n * Based on `dumpException` in\n * https://github.com/davepacheco/node-extsprintf/blob/master/lib/extsprintf.js\n */\n\n\nfunction getFullErrorStack(ex) {\n  var ret = ex.stack || ex.toString();\n\n  if (ex.cause && typeof ex.cause === 'function') {\n    var cex = ex.cause();\n\n    if (cex) {\n      ret += '\\nCaused by: ' + getFullErrorStack(cex);\n    }\n  }\n\n  return ret;\n} // Serialize an Error object\n// (Core error properties are enumerable in node 0.4, not in 0.6).\n\n\nvar errSerializer = Logger.stdSerializers.err = function (err) {\n  if (!err || !err.stack) return err;\n  var obj = {\n    message: err.message,\n    name: err.name,\n    stack: getFullErrorStack(err),\n    code: err.code,\n    signal: err.signal\n  };\n  return obj;\n}; // A JSON stringifier that handles cycles safely - tracks seen values in a Set.\n\n\nfunction safeCyclesSet() {\n  var seen = new Set();\n  return function (key, val) {\n    if (!val || typeof val !== 'object') {\n      return val;\n    }\n\n    if (seen.has(val)) {\n      return '[Circular]';\n    }\n\n    seen.add(val);\n    return val;\n  };\n}\n/**\n * A JSON stringifier that handles cycles safely - tracks seen vals in an Array.\n *\n * Note: This approach has performance problems when dealing with large objects,\n * see trentm/node-bunyan#445, but since this is the only option for node 0.10\n * and earlier (as Set was introduced in Node 0.12), it's used as a fallback\n * when Set is not available.\n */\n\n\nfunction safeCyclesArray() {\n  var seen = [];\n  return function (key, val) {\n    if (!val || typeof val !== 'object') {\n      return val;\n    }\n\n    if (seen.indexOf(val) !== -1) {\n      return '[Circular]';\n    }\n\n    seen.push(val);\n    return val;\n  };\n}\n/**\n * A JSON stringifier that handles cycles safely.\n *\n * Usage: JSON.stringify(obj, safeCycles())\n *\n * Choose the best safe cycle function from what is available - see\n * trentm/node-bunyan#445.\n */\n\n\nvar safeCycles = typeof Set !== 'undefined' ? safeCyclesSet : safeCyclesArray;\n/**\n * A fast JSON.stringify that handles cycles and getter exceptions (when\n * safeJsonStringify is installed).\n *\n * This function attempts to use the regular JSON.stringify for speed, but on\n * error (e.g. JSON cycle detection exception) it falls back to safe stringify\n * handlers that can deal with cycles and/or getter exceptions.\n */\n\nfunction fastAndSafeJsonStringify(rec) {\n  try {\n    return JSON.stringify(rec);\n  } catch (ex) {\n    try {\n      return JSON.stringify(rec, safeCycles());\n    } catch (e) {\n      if (safeJsonStringify) {\n        return safeJsonStringify(rec);\n      } else {\n        var dedupKey = e.stack.split(/\\n/g, 3).join('\\n');\n\n        _warn('bunyan: ERROR: Exception in ' + '`JSON.stringify(rec)`. You can install the ' + '\"safe-json-stringify\" module to have Bunyan fallback ' + 'to safer stringification. Record:\\n' + _indent(format('%s\\n%s', util.inspect(rec), e.stack)), dedupKey);\n\n        return format('(Exception in JSON.stringify(rec): %j. ' + 'See stderr for details.)', e.message);\n      }\n    }\n  }\n}\n\nvar RotatingFileStream = null;\n\nif (mv) {\n  RotatingFileStream = function RotatingFileStream(options) {\n    this.path = options.path;\n    this.count = options.count == null ? 10 : options.count;\n    assert.equal(typeof this.count, 'number', format('rotating-file stream \"count\" is not a number: %j (%s) in %j', this.count, typeof this.count, this));\n    assert.ok(this.count >= 0, format('rotating-file stream \"count\" is not >= 0: %j in %j', this.count, this)); // Parse `options.period`.\n\n    if (options.period) {\n      // <number><scope> where scope is:\n      //    h   hours (at the start of the hour)\n      //    d   days (at the start of the day, i.e. just after midnight)\n      //    w   weeks (at the start of Sunday)\n      //    m   months (on the first of the month)\n      //    y   years (at the start of Jan 1st)\n      // with special values 'hourly' (1h), 'daily' (1d), \"weekly\" (1w),\n      // 'monthly' (1m) and 'yearly' (1y)\n      var period = {\n        'hourly': '1h',\n        'daily': '1d',\n        'weekly': '1w',\n        'monthly': '1m',\n        'yearly': '1y'\n      }[options.period] || options.period;\n      var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);\n\n      if (!m) {\n        throw new Error(format('invalid period: \"%s\"', options.period));\n      }\n\n      this.periodNum = Number(m[1]);\n      this.periodScope = m[2];\n    } else {\n      this.periodNum = 1;\n      this.periodScope = 'd';\n    }\n\n    var lastModified = null;\n\n    try {\n      var fileInfo = fs.statSync(this.path);\n      lastModified = fileInfo.mtime.getTime();\n    } catch (err) {// file doesn't exist\n    }\n\n    var rotateAfterOpen = false;\n\n    if (lastModified) {\n      var lastRotTime = this._calcRotTime(0);\n\n      if (lastModified < lastRotTime) {\n        rotateAfterOpen = true;\n      }\n    } // TODO: template support for backup files\n    // template: <path to which to rotate>\n    //      default is %P.%n\n    //      '/var/log/archive/foo.log'  -> foo.log.%n\n    //      '/var/log/archive/foo.log.%n'\n    //      codes:\n    //          XXX support strftime codes (per node version of those)\n    //              or whatever module. Pick non-colliding for extra\n    //              codes\n    //          %P      `path` base value\n    //          %n      integer number of rotated log (1,2,3,...)\n    //          %d      datetime in YYYY-MM-DD_HH-MM-SS\n    //                      XXX what should default date format be?\n    //                          prior art? Want to avoid ':' in\n    //                          filenames (illegal on Windows for one).\n\n\n    this.stream = fs.createWriteStream(this.path, {\n      flags: 'a',\n      encoding: 'utf8'\n    });\n    this.rotQueue = [];\n    this.rotating = false;\n\n    if (rotateAfterOpen) {\n      this._debug('rotateAfterOpen -> call rotate()');\n\n      this.rotate();\n    } else {\n      this._setupNextRot();\n    }\n  };\n\n  util.inherits(RotatingFileStream, EventEmitter);\n\n  RotatingFileStream.prototype._debug = function () {\n    // Set this to `true` to add debug logging.\n    if (false) {\n      if (arguments.length === 0) {\n        return true;\n      }\n\n      var args = Array.prototype.slice.call(arguments);\n      args[0] = '[' + new Date().toISOString() + ', ' + this.path + '] ' + args[0];\n      console.log.apply(this, args);\n    } else {\n      return false;\n    }\n  };\n\n  RotatingFileStream.prototype._setupNextRot = function () {\n    this.rotAt = this._calcRotTime(1);\n\n    this._setRotationTimer();\n  };\n\n  RotatingFileStream.prototype._setRotationTimer = function () {\n    var self = this;\n    var delay = this.rotAt - Date.now(); // Cap timeout to Node's max setTimeout, see\n    // <https://github.com/joyent/node/issues/8656>.\n\n    var TIMEOUT_MAX = 2147483647; // 2^31-1\n\n    if (delay > TIMEOUT_MAX) {\n      delay = TIMEOUT_MAX;\n    }\n\n    this.timeout = setTimeout(function () {\n      self._debug('_setRotationTimer timeout -> call rotate()');\n\n      self.rotate();\n    }, delay);\n\n    if (typeof this.timeout.unref === 'function') {\n      this.timeout.unref();\n    }\n  };\n\n  RotatingFileStream.prototype._calcRotTime = function _calcRotTime(periodOffset) {\n    this._debug('_calcRotTime: %s%s', this.periodNum, this.periodScope);\n\n    var d = new Date();\n\n    this._debug('  now local: %s', d);\n\n    this._debug('    now utc: %s', d.toISOString());\n\n    var rotAt;\n\n    switch (this.periodScope) {\n      case 'ms':\n        // Hidden millisecond period for debugging.\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * periodOffset;\n        } else {\n          rotAt = Date.now() + this.periodNum * periodOffset;\n        }\n\n        break;\n\n      case 'h':\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * 60 * 60 * 1000 * periodOffset;\n        } else {\n          // First time: top of the next hour.\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(), d.getUTCHours() + periodOffset);\n        }\n\n        break;\n\n      case 'd':\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * 24 * 60 * 60 * 1000 * periodOffset;\n        } else {\n          // First time: start of tomorrow (i.e. at the coming midnight) UTC.\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() + periodOffset);\n        }\n\n        break;\n\n      case 'w':\n        // Currently, always on Sunday morning at 00:00:00 (UTC).\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * 7 * 24 * 60 * 60 * 1000 * periodOffset;\n        } else {\n          // First time: this coming Sunday.\n          var dayOffset = 7 - d.getUTCDay();\n\n          if (periodOffset < 1) {\n            dayOffset = -d.getUTCDay();\n          }\n\n          if (periodOffset > 1 || periodOffset < -1) {\n            dayOffset += 7 * periodOffset;\n          }\n\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() + dayOffset);\n        }\n\n        break;\n\n      case 'm':\n        if (this.rotAt) {\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + this.periodNum * periodOffset, 1);\n        } else {\n          // First time: the start of the next month.\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + periodOffset, 1);\n        }\n\n        break;\n\n      case 'y':\n        if (this.rotAt) {\n          rotAt = Date.UTC(d.getUTCFullYear() + this.periodNum * periodOffset, 0, 1);\n        } else {\n          // First time: the start of the next year.\n          rotAt = Date.UTC(d.getUTCFullYear() + periodOffset, 0, 1);\n        }\n\n        break;\n\n      default:\n        assert.fail(format('invalid period scope: \"%s\"', this.periodScope));\n    }\n\n    if (this._debug()) {\n      this._debug('  **rotAt**: %s (utc: %s)', rotAt, new Date(rotAt).toUTCString());\n\n      var now = Date.now();\n\n      this._debug('        now: %s (%sms == %smin == %sh to go)', now, rotAt - now, (rotAt - now) / 1000 / 60, (rotAt - now) / 1000 / 60 / 60);\n    }\n\n    return rotAt;\n  };\n\n  RotatingFileStream.prototype.rotate = function rotate() {\n    // XXX What about shutdown?\n    var self = this; // If rotation period is > ~25 days, we have to break into multiple\n    // setTimeout's. See <https://github.com/joyent/node/issues/8656>.\n\n    if (self.rotAt && self.rotAt > Date.now()) {\n      return self._setRotationTimer();\n    }\n\n    this._debug('rotate');\n\n    if (self.rotating) {\n      throw new TypeError('cannot start a rotation when already rotating');\n    }\n\n    self.rotating = true;\n    self.stream.end(); // XXX can do moves sync after this? test at high rate\n\n    function del() {\n      var toDel = self.path + '.' + String(n - 1);\n\n      if (n === 0) {\n        toDel = self.path;\n      }\n\n      n -= 1;\n\n      self._debug('  rm %s', toDel);\n\n      fs.unlink(toDel, function (delErr) {\n        //XXX handle err other than not exists\n        moves();\n      });\n    }\n\n    function moves() {\n      if (self.count === 0 || n < 0) {\n        return finish();\n      }\n\n      var before = self.path;\n      var after = self.path + '.' + String(n);\n\n      if (n > 0) {\n        before += '.' + String(n - 1);\n      }\n\n      n -= 1;\n      fs.exists(before, function (exists) {\n        if (!exists) {\n          moves();\n        } else {\n          self._debug('  mv %s %s', before, after);\n\n          mv(before, after, function (mvErr) {\n            if (mvErr) {\n              self.emit('error', mvErr);\n              finish(); // XXX finish here?\n            } else {\n              moves();\n            }\n          });\n        }\n      });\n    }\n\n    function finish() {\n      self._debug('  open %s', self.path);\n\n      self.stream = fs.createWriteStream(self.path, {\n        flags: 'a',\n        encoding: 'utf8'\n      });\n      var q = self.rotQueue,\n          len = q.length;\n\n      for (var i = 0; i < len; i++) {\n        self.stream.write(q[i]);\n      }\n\n      self.rotQueue = [];\n      self.rotating = false;\n      self.emit('drain');\n\n      self._setupNextRot();\n    }\n\n    var n = this.count;\n    del();\n  };\n\n  RotatingFileStream.prototype.write = function write(s) {\n    if (this.rotating) {\n      this.rotQueue.push(s);\n      return false;\n    } else {\n      return this.stream.write(s);\n    }\n  };\n\n  RotatingFileStream.prototype.end = function end(s) {\n    this.stream.end();\n  };\n\n  RotatingFileStream.prototype.destroy = function destroy(s) {\n    this.stream.destroy();\n  };\n\n  RotatingFileStream.prototype.destroySoon = function destroySoon(s) {\n    this.stream.destroySoon();\n  };\n}\n/* if (mv) */\n\n/**\n * RingBuffer is a Writable Stream that just stores the last N records in\n * memory.\n *\n * @param options {Object}, with the following fields:\n *\n *    - limit: number of records to keep in memory\n */\n\n\nfunction RingBuffer(options) {\n  this.limit = options && options.limit ? options.limit : 100;\n  this.writable = true;\n  this.records = [];\n  EventEmitter.call(this);\n}\n\nutil.inherits(RingBuffer, EventEmitter);\n\nRingBuffer.prototype.write = function (record) {\n  if (!this.writable) throw new Error('RingBuffer has been ended already');\n  this.records.push(record);\n  if (this.records.length > this.limit) this.records.shift();\n  return true;\n};\n\nRingBuffer.prototype.end = function () {\n  if (arguments.length > 0) this.write.apply(this, Array.prototype.slice.call(arguments));\n  this.writable = false;\n};\n\nRingBuffer.prototype.destroy = function () {\n  this.writable = false;\n  this.emit('close');\n};\n\nRingBuffer.prototype.destroySoon = function () {\n  this.destroy();\n}; //---- Exports\n\n\nmodule.exports = Logger;\nmodule.exports.TRACE = TRACE;\nmodule.exports.DEBUG = DEBUG;\nmodule.exports.INFO = INFO;\nmodule.exports.WARN = WARN;\nmodule.exports.ERROR = ERROR;\nmodule.exports.FATAL = FATAL;\nmodule.exports.resolveLevel = resolveLevel;\nmodule.exports.levelFromName = levelFromName;\nmodule.exports.nameFromLevel = nameFromLevel;\nmodule.exports.VERSION = VERSION;\nmodule.exports.LOG_VERSION = LOG_VERSION;\n\nmodule.exports.createLogger = function createLogger(options) {\n  return new Logger(options);\n};\n\nmodule.exports.RingBuffer = RingBuffer;\nmodule.exports.RotatingFileStream = RotatingFileStream; // Useful for custom `type == 'raw'` streams that may do JSON stringification\n// of log records themselves. Usage:\n//    var str = JSON.stringify(rec, bunyan.safeCycles());\n\nmodule.exports.safeCycles = safeCycles;","map":{"version":3,"sources":["/home/lisk/doomonlisk/node_modules/bunyan/lib/bunyan.js"],"names":["VERSION","LOG_VERSION","xxx","s","args","concat","Array","prototype","slice","call","arguments","console","error","apply","runtimeEnv","process","versions","nw","node","window","Error","os","fs","dtrace","hostname","location","host","require","e","util","assert","EventEmitter","stream","safeJsonStringify","env","BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY","mv","sourceMapSupport","_","objCopy","obj","isArray","copy","Object","keys","forEach","k","format","inspect","formatRegExp","f","objects","i","length","push","join","len","str","String","replace","x","Number","fastAndSafeJsonStringify","getCaller3Info","undefined","saveLimit","stackTraceLimit","savePrepare","prepareStackTrace","stack","caller","wrapCallSite","file","getFileName","line","getLineNumber","func","getFunctionName","captureStackTrace","_indent","indent","lines","split","_warn","msg","dedupKey","ok","_warned","stderr","write","_haveWarned","ConsoleRawStream","rec","level","INFO","log","WARN","info","ERROR","warn","TRACE","DEBUG","FATAL","levelFromName","nameFromLevel","name","dtp","probes","resolveLevel","nameOrNum","type","toLowerCase","TypeError","Math","floor","isWritable","Writable","Logger","options","_childOptions","_childSimple","parent","streams","serializers","_isSimpleChild","_level","src","fields","parentFieldNames","names","self","closeOnExit","POSITIVE_INFINITY","createDTraceProvider","probe","addProbe","enable","addStream","stdout","addSerializers","_applySerializers","pid","inherits","defaultLevel","path","raw","reemitErrorEvents","createWriteStream","flags","encoding","RotatingFileStream","on","onStreamError","err","emit","haveNonRawStreams","field","serializer","child","simple","constructor","reopenFileStreams","end","destroySoon","value","newLevel","levels","equal","map","excludeFields","_emit","noemit","EOL","mkRecord","minLevel","msgArgs","stdSerializers","message","Buffer","isBuffer","recFields","time","Date","v","mkProbeArgs","mkLogEmitter","fire","trace","debug","fatal","req","connection","method","url","originalUrl","headers","remoteAddress","remotePort","res","statusCode","header","_header","getFullErrorStack","ex","ret","toString","cause","cex","errSerializer","code","signal","safeCyclesSet","seen","Set","key","val","has","add","safeCyclesArray","indexOf","safeCycles","JSON","stringify","count","period","m","exec","periodNum","periodScope","lastModified","fileInfo","statSync","mtime","getTime","rotateAfterOpen","lastRotTime","_calcRotTime","rotQueue","rotating","_debug","rotate","_setupNextRot","toISOString","rotAt","_setRotationTimer","delay","now","TIMEOUT_MAX","timeout","setTimeout","unref","periodOffset","d","UTC","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","dayOffset","getUTCDay","fail","toUTCString","del","toDel","n","unlink","delErr","moves","finish","before","after","exists","mvErr","q","destroy","RingBuffer","limit","writable","records","record","shift","module","exports","createLogger"],"mappings":"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","sourcesContent":["/**\n * Copyright 2021 Trent Mick.\n * Copyright 2020 Joyent Inc.\n *\n * The bunyan logging library for node.js.\n *\n * -*- mode: js -*-\n * vim: expandtab:ts=4:sw=4\n */\n\nvar VERSION = '1.8.15';\n\n/*\n * Bunyan log format version. This becomes the 'v' field on all log records.\n * This will be incremented if there is any backward incompatible change to\n * the log record format. Details will be in 'CHANGES.md' (the change log).\n */\nvar LOG_VERSION = 0;\n\n\nvar xxx = function xxx(s) {     // internal dev/debug logging\n    var args = ['XX' + 'X: '+s].concat(\n        Array.prototype.slice.call(arguments, 1));\n    console.error.apply(this, args);\n};\nvar xxx = function xxx() {};  // comment out to turn on debug logging\n\n\n/*\n * Runtime environment notes:\n *\n * Bunyan is intended to run in a number of runtime environments. Here are\n * some notes on differences for those envs and how the code copes.\n *\n * - node.js: The primary target environment.\n * - NW.js: http://nwjs.io/  An *app* environment that feels like both a\n *   node env -- it has node-like globals (`process`, `global`) and\n *   browser-like globals (`window`, `navigator`). My *understanding* is that\n *   bunyan can operate as if this is vanilla node.js.\n * - browser: Failing the above, we sniff using the `window` global\n *   <https://developer.mozilla.org/en-US/docs/Web/API/Window/window>.\n *      - browserify: http://browserify.org/  A browser-targetting bundler of\n *        node.js deps. The runtime is a browser env, so can't use fs access,\n *        etc. Browserify's build looks for `require(<single-string>)` imports\n *        to bundle. For some imports it won't be able to handle, we \"hide\"\n *        from browserify with `require('frobshizzle' + '')`.\n * - Other? Please open issues if things are broken.\n */\nvar runtimeEnv;\nif (typeof (process) !== 'undefined' && process.versions) {\n    if (process.versions.nw) {\n        runtimeEnv = 'nw';\n    } else if (process.versions.node) {\n        runtimeEnv = 'node';\n    }\n}\nif (!runtimeEnv && typeof (window) !== 'undefined' &&\n    window.window === window) {\n    runtimeEnv = 'browser';\n}\nif (!runtimeEnv) {\n    throw new Error('unknown runtime environment');\n}\n\n\nvar os, fs, dtrace;\nif (runtimeEnv === 'browser') {\n    os = {\n        hostname: function () {\n            return window.location.host;\n        }\n    };\n    fs = {};\n    dtrace = null;\n} else {\n    os = require('os');\n    fs = require('fs');\n    try {\n        dtrace = require('dtrace-provider' + '');\n    } catch (e) {\n        dtrace = null;\n    }\n}\nvar util = require('util');\nvar assert = require('assert');\nvar EventEmitter = require('events').EventEmitter;\nvar stream = require('stream');\n\ntry {\n    var safeJsonStringify = require('safe-json-stringify');\n} catch (e) {\n    safeJsonStringify = null;\n}\nif (process.env.BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY) {\n    safeJsonStringify = null;\n}\n\n// The 'mv' module is required for rotating-file stream support.\ntry {\n    var mv = require('mv' + '');\n} catch (e) {\n    mv = null;\n}\n\ntry {\n    var sourceMapSupport = require('source-map-support' + '');\n} catch (_) {\n    sourceMapSupport = null;\n}\n\n\n//---- Internal support stuff\n\n/**\n * A shallow copy of an object. Bunyan logging attempts to never cause\n * exceptions, so this function attempts to handle non-objects gracefully.\n */\nfunction objCopy(obj) {\n    if (obj == null) {  // null or undefined\n        return obj;\n    } else if (Array.isArray(obj)) {\n        return obj.slice();\n    } else if (typeof (obj) === 'object') {\n        var copy = {};\n        Object.keys(obj).forEach(function (k) {\n            copy[k] = obj[k];\n        });\n        return copy;\n    } else {\n        return obj;\n    }\n}\n\nvar format = util.format;\nif (!format) {\n    // If node < 0.6, then use its `util.format`:\n    // <https://github.com/joyent/node/blob/master/lib/util.js#L22>:\n    var inspect = util.inspect;\n    var formatRegExp = /%[sdj%]/g;\n    format = function format(f) {\n        if (typeof (f) !== 'string') {\n            var objects = [];\n            for (var i = 0; i < arguments.length; i++) {\n                objects.push(inspect(arguments[i]));\n            }\n            return objects.join(' ');\n        }\n\n        var i = 1;\n        var args = arguments;\n        var len = args.length;\n        var str = String(f).replace(formatRegExp, function (x) {\n            if (i >= len)\n                return x;\n            switch (x) {\n                case '%s': return String(args[i++]);\n                case '%d': return Number(args[i++]);\n                case '%j': return fastAndSafeJsonStringify(args[i++]);\n                case '%%': return '%';\n                default:\n                    return x;\n            }\n        });\n        for (var x = args[i]; i < len; x = args[++i]) {\n            if (x === null || typeof (x) !== 'object') {\n                str += ' ' + x;\n            } else {\n                str += ' ' + inspect(x);\n            }\n        }\n        return str;\n    };\n}\n\n\n/**\n * Gather some caller info 3 stack levels up.\n * See <http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi>.\n */\nfunction getCaller3Info() {\n    if (this === undefined) {\n        // Cannot access caller info in 'strict' mode.\n        return;\n    }\n    var obj = {};\n    var saveLimit = Error.stackTraceLimit;\n    var savePrepare = Error.prepareStackTrace;\n    Error.stackTraceLimit = 3;\n\n    Error.prepareStackTrace = function (_, stack) {\n        var caller = stack[2];\n        if (sourceMapSupport) {\n            caller = sourceMapSupport.wrapCallSite(caller);\n        }\n        obj.file = caller.getFileName();\n        obj.line = caller.getLineNumber();\n        var func = caller.getFunctionName();\n        if (func)\n            obj.func = func;\n    };\n    Error.captureStackTrace(this, getCaller3Info);\n    this.stack;\n\n    Error.stackTraceLimit = saveLimit;\n    Error.prepareStackTrace = savePrepare;\n    return obj;\n}\n\n\nfunction _indent(s, indent) {\n    if (!indent) indent = '    ';\n    var lines = s.split(/\\r?\\n/g);\n    return indent + lines.join('\\n' + indent);\n}\n\n\n/**\n * Warn about an bunyan processing error.\n *\n * @param msg {String} Message with which to warn.\n * @param dedupKey {String} Optional. A short string key for this warning to\n *      have its warning only printed once.\n */\nfunction _warn(msg, dedupKey) {\n    assert.ok(msg);\n    if (dedupKey) {\n        if (_warned[dedupKey]) {\n            return;\n        }\n        _warned[dedupKey] = true;\n    }\n    process.stderr.write(msg + '\\n');\n}\nfunction _haveWarned(dedupKey) {\n    return _warned[dedupKey];\n}\nvar _warned = {};\n\n\nfunction ConsoleRawStream() {}\nConsoleRawStream.prototype.write = function (rec) {\n    if (rec.level < INFO) {\n        console.log(rec);\n    } else if (rec.level < WARN) {\n        console.info(rec);\n    } else if (rec.level < ERROR) {\n        console.warn(rec);\n    } else {\n        console.error(rec);\n    }\n};\n\n\n//---- Levels\n\nvar TRACE = 10;\nvar DEBUG = 20;\nvar INFO = 30;\nvar WARN = 40;\nvar ERROR = 50;\nvar FATAL = 60;\n\nvar levelFromName = {\n    'trace': TRACE,\n    'debug': DEBUG,\n    'info': INFO,\n    'warn': WARN,\n    'error': ERROR,\n    'fatal': FATAL\n};\nvar nameFromLevel = {};\nObject.keys(levelFromName).forEach(function (name) {\n    nameFromLevel[levelFromName[name]] = name;\n});\n\n// Dtrace probes.\nvar dtp = undefined;\nvar probes = dtrace && {};\n\n/**\n * Resolve a level number, name (upper or lowercase) to a level number value.\n *\n * @param nameOrNum {String|Number} A level name (case-insensitive) or positive\n *      integer level.\n * @api public\n */\nfunction resolveLevel(nameOrNum) {\n    var level;\n    var type = typeof (nameOrNum);\n    if (type === 'string') {\n        level = levelFromName[nameOrNum.toLowerCase()];\n        if (!level) {\n            throw new Error(format('unknown level name: \"%s\"', nameOrNum));\n        }\n    } else if (type !== 'number') {\n        throw new TypeError(format('cannot resolve level: invalid arg (%s):',\n            type, nameOrNum));\n    } else if (nameOrNum < 0 || Math.floor(nameOrNum) !== nameOrNum) {\n        throw new TypeError(format('level is not a positive integer: %s',\n            nameOrNum));\n    } else {\n        level = nameOrNum;\n    }\n    return level;\n}\n\n\nfunction isWritable(obj) {\n    if (obj instanceof stream.Writable) {\n        return true;\n    }\n    return typeof (obj.write) === 'function';\n}\n\n\n//---- Logger class\n\n/**\n * Create a Logger instance.\n *\n * @param options {Object} See documentation for full details. At minimum\n *    this must include a 'name' string key. Configuration keys:\n *      - `streams`: specify the logger output streams. This is an array of\n *        objects with these fields:\n *          - `type`: The stream type. See README.md for full details.\n *            Often this is implied by the other fields. Examples are\n *            'file', 'stream' and \"raw\".\n *          - `level`: Defaults to 'info'.\n *          - `path` or `stream`: The specify the file path or writeable\n *            stream to which log records are written. E.g.\n *            `stream: process.stdout`.\n *          - `closeOnExit` (boolean): Optional. Default is true for a\n *            'file' stream when `path` is given, false otherwise.\n *        See README.md for full details.\n *      - `level`: set the level for a single output stream (cannot be used\n *        with `streams`)\n *      - `stream`: the output stream for a logger with just one, e.g.\n *        `process.stdout` (cannot be used with `streams`)\n *      - `serializers`: object mapping log record field names to\n *        serializing functions. See README.md for details.\n *      - `src`: Boolean (default false). Set true to enable 'src' automatic\n *        field with log call source info.\n *    All other keys are log record fields.\n *\n * An alternative *internal* call signature is used for creating a child:\n *    new Logger(<parent logger>, <child options>[, <child opts are simple>]);\n *\n * @param _childSimple (Boolean) An assertion that the given `_childOptions`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation.\n */\nfunction Logger(options, _childOptions, _childSimple) {\n    xxx('Logger start:', options)\n    if (!(this instanceof Logger)) {\n        return new Logger(options, _childOptions);\n    }\n\n    // Input arg validation.\n    var parent;\n    if (_childOptions !== undefined) {\n        parent = options;\n        options = _childOptions;\n        if (!(parent instanceof Logger)) {\n            throw new TypeError(\n                'invalid Logger creation: do not pass a second arg');\n        }\n    }\n    if (!options) {\n        throw new TypeError('options (object) is required');\n    }\n    if (!parent) {\n        if (!options.name) {\n            throw new TypeError('options.name (string) is required');\n        }\n    } else {\n        if (options.name) {\n            throw new TypeError(\n                'invalid options.name: child cannot set logger name');\n        }\n    }\n    if (options.stream && options.streams) {\n        throw new TypeError('cannot mix \"streams\" and \"stream\" options');\n    }\n    if (options.streams && !Array.isArray(options.streams)) {\n        throw new TypeError('invalid options.streams: must be an array')\n    }\n    if (options.serializers && (typeof (options.serializers) !== 'object' ||\n            Array.isArray(options.serializers))) {\n        throw new TypeError('invalid options.serializers: must be an object')\n    }\n\n    EventEmitter.call(this);\n\n    // Fast path for simple child creation.\n    if (parent && _childSimple) {\n        // `_isSimpleChild` is a signal to stream close handling that this child\n        // owns none of its streams.\n        this._isSimpleChild = true;\n\n        this._level = parent._level;\n        this.streams = parent.streams;\n        this.serializers = parent.serializers;\n        this.src = parent.src;\n        var fields = this.fields = {};\n        var parentFieldNames = Object.keys(parent.fields);\n        for (var i = 0; i < parentFieldNames.length; i++) {\n            var name = parentFieldNames[i];\n            fields[name] = parent.fields[name];\n        }\n        var names = Object.keys(options);\n        for (var i = 0; i < names.length; i++) {\n            var name = names[i];\n            fields[name] = options[name];\n        }\n        return;\n    }\n\n    // Start values.\n    var self = this;\n    if (parent) {\n        this._level = parent._level;\n        this.streams = [];\n        for (var i = 0; i < parent.streams.length; i++) {\n            var s = objCopy(parent.streams[i]);\n            s.closeOnExit = false; // Don't own parent stream.\n            this.streams.push(s);\n        }\n        this.serializers = objCopy(parent.serializers);\n        this.src = parent.src;\n        this.fields = objCopy(parent.fields);\n        if (options.level) {\n            this.level(options.level);\n        }\n    } else {\n        this._level = Number.POSITIVE_INFINITY;\n        this.streams = [];\n        this.serializers = null;\n        this.src = false;\n        this.fields = {};\n    }\n\n    if (!dtp && dtrace) {\n        dtp = dtrace.createDTraceProvider('bunyan');\n\n        for (var level in levelFromName) {\n            var probe;\n\n            probes[levelFromName[level]] = probe =\n                dtp.addProbe('log-' + level, 'char *');\n\n            // Explicitly add a reference to dtp to prevent it from being GC'd\n            probe.dtp = dtp;\n        }\n\n        dtp.enable();\n    }\n\n    // Handle *config* options (i.e. options that are not just plain data\n    // for log records).\n    if (options.stream) {\n        self.addStream({\n            type: 'stream',\n            stream: options.stream,\n            closeOnExit: false,\n            level: options.level\n        });\n    } else if (options.streams) {\n        options.streams.forEach(function (s) {\n            self.addStream(s, options.level);\n        });\n    } else if (parent && options.level) {\n        this.level(options.level);\n    } else if (!parent) {\n        if (runtimeEnv === 'browser') {\n            /*\n             * In the browser we'll be emitting to console.log by default.\n             * Any console.log worth its salt these days can nicely render\n             * and introspect objects (e.g. the Firefox and Chrome console)\n             * so let's emit the raw log record. Are there browsers for which\n             * that breaks things?\n             */\n            self.addStream({\n                type: 'raw',\n                stream: new ConsoleRawStream(),\n                closeOnExit: false,\n                level: options.level\n            });\n        } else {\n            self.addStream({\n                type: 'stream',\n                stream: process.stdout,\n                closeOnExit: false,\n                level: options.level\n            });\n        }\n    }\n    if (options.serializers) {\n        self.addSerializers(options.serializers);\n    }\n    if (options.src) {\n        this.src = true;\n    }\n    xxx('Logger: ', self)\n\n    // Fields.\n    // These are the default fields for log records (minus the attributes\n    // removed in this constructor). To allow storing raw log records\n    // (unrendered), `this.fields` must never be mutated. Create a copy for\n    // any changes.\n    var fields = objCopy(options);\n    delete fields.stream;\n    delete fields.level;\n    delete fields.streams;\n    delete fields.serializers;\n    delete fields.src;\n    if (this.serializers) {\n        this._applySerializers(fields);\n    }\n    if (!fields.hostname && !self.fields.hostname) {\n        fields.hostname = os.hostname();\n    }\n    if (!fields.pid) {\n        fields.pid = process.pid;\n    }\n    Object.keys(fields).forEach(function (k) {\n        self.fields[k] = fields[k];\n    });\n}\n\nutil.inherits(Logger, EventEmitter);\n\n\n/**\n * Add a stream\n *\n * @param stream {Object}. Object with these fields:\n *    - `type`: The stream type. See README.md for full details.\n *      Often this is implied by the other fields. Examples are\n *      'file', 'stream' and \"raw\".\n *    - `path` or `stream`: The specify the file path or writeable\n *      stream to which log records are written. E.g.\n *      `stream: process.stdout`.\n *    - `level`: Optional. Falls back to `defaultLevel`.\n *    - `closeOnExit` (boolean): Optional. Default is true for a\n *      'file' stream when `path` is given, false otherwise.\n *    See README.md for full details.\n * @param defaultLevel {Number|String} Optional. A level to use if\n *      `stream.level` is not set. If neither is given, this defaults to INFO.\n */\nLogger.prototype.addStream = function addStream(s, defaultLevel) {\n    var self = this;\n    if (defaultLevel === null || defaultLevel === undefined) {\n        defaultLevel = INFO;\n    }\n\n    s = objCopy(s);\n\n    // Implicit 'type' from other args.\n    if (!s.type) {\n        if (s.stream) {\n            s.type = 'stream';\n        } else if (s.path) {\n            s.type = 'file'\n        }\n    }\n    s.raw = (s.type === 'raw');  // PERF: Allow for faster check in `_emit`.\n\n    if (s.level !== undefined) {\n        s.level = resolveLevel(s.level);\n    } else {\n        s.level = resolveLevel(defaultLevel);\n    }\n    if (s.level < self._level) {\n        self._level = s.level;\n    }\n\n    switch (s.type) {\n    case 'stream':\n        assert.ok(isWritable(s.stream),\n                  '\"stream\" stream is not writable: ' + util.inspect(s.stream));\n\n        if (!s.closeOnExit) {\n            s.closeOnExit = false;\n        }\n        break;\n    case 'file':\n        if (s.reemitErrorEvents === undefined) {\n            s.reemitErrorEvents = true;\n        }\n        if (!s.stream) {\n            s.stream = fs.createWriteStream(s.path,\n                                            {flags: 'a', encoding: 'utf8'});\n            if (!s.closeOnExit) {\n                s.closeOnExit = true;\n            }\n        } else {\n            if (!s.closeOnExit) {\n                s.closeOnExit = false;\n            }\n        }\n        break;\n    case 'rotating-file':\n        assert.ok(!s.stream,\n                  '\"rotating-file\" stream should not give a \"stream\"');\n        assert.ok(s.path);\n        assert.ok(mv, '\"rotating-file\" stream type is not supported: '\n                      + 'missing \"mv\" module');\n        s.stream = new RotatingFileStream(s);\n        if (!s.closeOnExit) {\n            s.closeOnExit = true;\n        }\n        break;\n    case 'raw':\n        if (!s.closeOnExit) {\n            s.closeOnExit = false;\n        }\n        break;\n    default:\n        throw new TypeError('unknown stream type \"' + s.type + '\"');\n    }\n\n    if (s.reemitErrorEvents && typeof (s.stream.on) === 'function') {\n        // TODO: When we have `<logger>.close()`, it should remove event\n        //      listeners to not leak Logger instances.\n        s.stream.on('error', function onStreamError(err) {\n            self.emit('error', err, s);\n        });\n    }\n\n    self.streams.push(s);\n    delete self.haveNonRawStreams;  // reset\n}\n\n\n/**\n * Add serializers\n *\n * @param serializers {Object} Optional. Object mapping log record field names\n *    to serializing functions. See README.md for details.\n */\nLogger.prototype.addSerializers = function addSerializers(serializers) {\n    var self = this;\n\n    if (!self.serializers) {\n        self.serializers = {};\n    }\n    Object.keys(serializers).forEach(function (field) {\n        var serializer = serializers[field];\n        if (typeof (serializer) !== 'function') {\n            throw new TypeError(format(\n                'invalid serializer for \"%s\" field: must be a function',\n                field));\n        } else {\n            self.serializers[field] = serializer;\n        }\n    });\n}\n\n\n\n/**\n * Create a child logger, typically to add a few log record fields.\n *\n * This can be useful when passing a logger to a sub-component, e.g. a\n * 'wuzzle' component of your service:\n *\n *    var wuzzleLog = log.child({component: 'wuzzle'})\n *    var wuzzle = new Wuzzle({..., log: wuzzleLog})\n *\n * Then log records from the wuzzle code will have the same structure as\n * the app log, *plus the component='wuzzle' field*.\n *\n * @param options {Object} Optional. Set of options to apply to the child.\n *    All of the same options for a new Logger apply here. Notes:\n *      - The parent's streams are inherited and cannot be removed in this\n *        call. Any given `streams` are *added* to the set inherited from\n *        the parent.\n *      - The parent's serializers are inherited, though can effectively be\n *        overwritten by using duplicate keys.\n *      - Can use `level` to set the level of the streams inherited from\n *        the parent. The level for the parent is NOT affected.\n * @param simple {Boolean} Optional. Set to true to assert that `options`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation. See 'tools/timechild.js' for numbers.\n */\nLogger.prototype.child = function (options, simple) {\n    return new (this.constructor)(this, options || {}, simple);\n}\n\n\n/**\n * A convenience method to reopen 'file' streams on a logger. This can be\n * useful with external log rotation utilities that move and re-open log files\n * (e.g. logrotate on Linux, logadm on SmartOS/Illumos). Those utilities\n * typically have rotation options to copy-and-truncate the log file, but\n * you may not want to use that. An alternative is to do this in your\n * application:\n *\n *      var log = bunyan.createLogger(...);\n *      ...\n *      process.on('SIGUSR2', function () {\n *          log.reopenFileStreams();\n *      });\n *      ...\n *\n * See <https://github.com/trentm/node-bunyan/issues/104>.\n */\nLogger.prototype.reopenFileStreams = function () {\n    var self = this;\n    self.streams.forEach(function (s) {\n        if (s.type === 'file') {\n            if (s.stream) {\n                // Not sure if typically would want this, or more immediate\n                // `s.stream.destroy()`.\n                s.stream.end();\n                s.stream.destroySoon();\n                delete s.stream;\n            }\n            s.stream = fs.createWriteStream(s.path,\n                {flags: 'a', encoding: 'utf8'});\n            s.stream.on('error', function (err) {\n                self.emit('error', err, s);\n            });\n        }\n    });\n};\n\n\n/* BEGIN JSSTYLED */\n/**\n * Close this logger.\n *\n * This closes streams (that it owns, as per 'endOnClose' attributes on\n * streams), etc. Typically you **don't** need to bother calling this.\nLogger.prototype.close = function () {\n    if (this._closed) {\n        return;\n    }\n    if (!this._isSimpleChild) {\n        self.streams.forEach(function (s) {\n            if (s.endOnClose) {\n                xxx('closing stream s:', s);\n                s.stream.end();\n                s.endOnClose = false;\n            }\n        });\n    }\n    this._closed = true;\n}\n */\n/* END JSSTYLED */\n\n\n/**\n * Get/set the level of all streams on this logger.\n *\n * Get Usage:\n *    // Returns the current log level (lowest level of all its streams).\n *    log.level() -> INFO\n *\n * Set Usage:\n *    log.level(INFO)       // set all streams to level INFO\n *    log.level('info')     // can use 'info' et al aliases\n */\nLogger.prototype.level = function level(value) {\n    if (value === undefined) {\n        return this._level;\n    }\n    var newLevel = resolveLevel(value);\n    var len = this.streams.length;\n    for (var i = 0; i < len; i++) {\n        this.streams[i].level = newLevel;\n    }\n    this._level = newLevel;\n}\n\n\n/**\n * Get/set the level of a particular stream on this logger.\n *\n * Get Usage:\n *    // Returns an array of the levels of each stream.\n *    log.levels() -> [TRACE, INFO]\n *\n *    // Returns a level of the identified stream.\n *    log.levels(0) -> TRACE      // level of stream at index 0\n *    log.levels('foo')           // level of stream with name 'foo'\n *\n * Set Usage:\n *    log.levels(0, INFO)         // set level of stream 0 to INFO\n *    log.levels(0, 'info')       // can use 'info' et al aliases\n *    log.levels('foo', WARN)     // set stream named 'foo' to WARN\n *\n * Stream names: When streams are defined, they can optionally be given\n * a name. For example,\n *       log = new Logger({\n *         streams: [\n *           {\n *             name: 'foo',\n *             path: '/var/log/my-service/foo.log'\n *             level: 'trace'\n *           },\n *         ...\n *\n * @param name {String|Number} The stream index or name.\n * @param value {Number|String} The level value (INFO) or alias ('info').\n *    If not given, this is a 'get' operation.\n * @throws {Error} If there is no stream with the given name.\n */\nLogger.prototype.levels = function levels(name, value) {\n    if (name === undefined) {\n        assert.equal(value, undefined);\n        return this.streams.map(\n            function (s) { return s.level });\n    }\n    var stream;\n    if (typeof (name) === 'number') {\n        stream = this.streams[name];\n        if (stream === undefined) {\n            throw new Error('invalid stream index: ' + name);\n        }\n    } else {\n        var len = this.streams.length;\n        for (var i = 0; i < len; i++) {\n            var s = this.streams[i];\n            if (s.name === name) {\n                stream = s;\n                break;\n            }\n        }\n        if (!stream) {\n            throw new Error(format('no stream with name \"%s\"', name));\n        }\n    }\n    if (value === undefined) {\n        return stream.level;\n    } else {\n        var newLevel = resolveLevel(value);\n        stream.level = newLevel;\n        if (newLevel < this._level) {\n            this._level = newLevel;\n        }\n    }\n}\n\n\n/**\n * Apply registered serializers to the appropriate keys in the given fields.\n *\n * Pre-condition: This is only called if there is at least one serializer.\n *\n * @param fields (Object) The log record fields.\n * @param excludeFields (Object) Optional mapping of keys to `true` for\n *    keys to NOT apply a serializer.\n */\nLogger.prototype._applySerializers = function (fields, excludeFields) {\n    var self = this;\n\n    xxx('_applySerializers: excludeFields', excludeFields);\n\n    // Check each serializer against these (presuming number of serializers\n    // is typically less than number of fields).\n    Object.keys(this.serializers).forEach(function (name) {\n        if (fields[name] === undefined ||\n            (excludeFields && excludeFields[name]))\n        {\n            return;\n        }\n        xxx('_applySerializers; apply to \"%s\" key', name)\n        try {\n            fields[name] = self.serializers[name](fields[name]);\n        } catch (err) {\n            _warn(format('bunyan: ERROR: Exception thrown from the \"%s\" '\n                + 'Bunyan serializer. This should never happen. This is a bug '\n                + 'in that serializer function.\\n%s',\n                name, err.stack || err));\n            fields[name] = format('(Error in Bunyan log \"%s\" serializer '\n                + 'broke field. See stderr for details.)', name);\n        }\n    });\n}\n\n\n/**\n * Emit a log record.\n *\n * @param rec {log record}\n * @param noemit {Boolean} Optional. Set to true to skip emission\n *      and just return the JSON string.\n */\nLogger.prototype._emit = function (rec, noemit) {\n    var i;\n\n    // Lazily determine if this Logger has non-'raw' streams. If there are\n    // any, then we need to stringify the log record.\n    if (this.haveNonRawStreams === undefined) {\n        this.haveNonRawStreams = false;\n        for (i = 0; i < this.streams.length; i++) {\n            if (!this.streams[i].raw) {\n                this.haveNonRawStreams = true;\n                break;\n            }\n        }\n    }\n\n    // Stringify the object (creates a warning str on error).\n    var str;\n    if (noemit || this.haveNonRawStreams) {\n        str = fastAndSafeJsonStringify(rec) + os.EOL;\n    }\n\n    if (noemit)\n        return str;\n\n    var level = rec.level;\n    for (i = 0; i < this.streams.length; i++) {\n        var s = this.streams[i];\n        if (s.level <= level) {\n            xxx('writing log rec \"%s\" to \"%s\" stream (%d <= %d): %j',\n                rec.msg, s.type, s.level, level, rec);\n            s.stream.write(s.raw ? rec : str);\n        }\n    };\n\n    return str;\n}\n\n\n/**\n * Build a record object suitable for emitting from the arguments\n * provided to the a log emitter.\n */\nfunction mkRecord(log, minLevel, args) {\n    var excludeFields, fields, msgArgs;\n    if (args[0] instanceof Error) {\n        // `log.<level>(err, ...)`\n        fields = {\n            // Use this Logger's err serializer, if defined.\n            err: (log.serializers && log.serializers.err\n                ? log.serializers.err(args[0])\n                : Logger.stdSerializers.err(args[0]))\n        };\n        excludeFields = {err: true};\n        if (args.length === 1) {\n            msgArgs = [fields.err.message];\n        } else {\n            msgArgs = args.slice(1);\n        }\n    } else if (typeof (args[0]) !== 'object' || Array.isArray(args[0])) {\n        // `log.<level>(msg, ...)`\n        fields = null;\n        msgArgs = args.slice();\n    } else if (Buffer.isBuffer(args[0])) {  // `log.<level>(buf, ...)`\n        // Almost certainly an error, show `inspect(buf)`. See bunyan\n        // issue #35.\n        fields = null;\n        msgArgs = args.slice();\n        msgArgs[0] = util.inspect(msgArgs[0]);\n    } else {  // `log.<level>(fields, msg, ...)`\n        fields = args[0];\n        if (fields && args.length === 1 && fields.err &&\n            fields.err instanceof Error)\n        {\n            msgArgs = [fields.err.message];\n        } else {\n            msgArgs = args.slice(1);\n        }\n    }\n\n    // Build up the record object.\n    var rec = objCopy(log.fields);\n    var level = rec.level = minLevel;\n    var recFields = (fields ? objCopy(fields) : null);\n    if (recFields) {\n        if (log.serializers) {\n            log._applySerializers(recFields, excludeFields);\n        }\n        Object.keys(recFields).forEach(function (k) {\n            rec[k] = recFields[k];\n        });\n    }\n    rec.msg = format.apply(log, msgArgs);\n    if (!rec.time) {\n        rec.time = (new Date());\n    }\n    // Get call source info\n    if (log.src && !rec.src) {\n        rec.src = getCaller3Info()\n    }\n    rec.v = LOG_VERSION;\n\n    return rec;\n};\n\n\n/**\n * Build an array that dtrace-provider can use to fire a USDT probe. If we've\n * already built the appropriate string, we use it. Otherwise, build the\n * record object and stringify it.\n */\nfunction mkProbeArgs(str, log, minLevel, msgArgs) {\n    return [ str || log._emit(mkRecord(log, minLevel, msgArgs), true) ];\n}\n\n\n/**\n * Build a log emitter function for level minLevel. I.e. this is the\n * creator of `log.info`, `log.error`, etc.\n */\nfunction mkLogEmitter(minLevel) {\n    return function () {\n        var log = this;\n        var str = null;\n        var rec = null;\n\n        if (!this._emit) {\n            /*\n             * Show this invalid Bunyan usage warning *once*.\n             *\n             * See <https://github.com/trentm/node-bunyan/issues/100> for\n             * an example of how this can happen.\n             */\n            var dedupKey = 'unbound';\n            if (!_haveWarned[dedupKey]) {\n                var caller = getCaller3Info();\n                _warn(format('bunyan usage error: %s:%s: attempt to log '\n                    + 'with an unbound log method: `this` is: %s',\n                    caller.file, caller.line, util.inspect(this)),\n                    dedupKey);\n            }\n            return;\n        } else if (arguments.length === 0) {   // `log.<level>()`\n            return (this._level <= minLevel);\n        }\n\n        var msgArgs = new Array(arguments.length);\n        for (var i = 0; i < msgArgs.length; ++i) {\n            msgArgs[i] = arguments[i];\n        }\n\n        if (this._level <= minLevel) {\n            rec = mkRecord(log, minLevel, msgArgs);\n            str = this._emit(rec);\n        }\n\n        if (probes) {\n            probes[minLevel].fire(mkProbeArgs, str, log, minLevel, msgArgs);\n        }\n    }\n}\n\n\n/**\n * The functions below log a record at a specific level.\n *\n * Usages:\n *    log.<level>()  -> boolean is-trace-enabled\n *    log.<level>(<Error> err, [<string> msg, ...])\n *    log.<level>(<string> msg, ...)\n *    log.<level>(<object> fields, <string> msg, ...)\n *\n * where <level> is the lowercase version of the log level. E.g.:\n *\n *    log.info()\n *\n * @params fields {Object} Optional set of additional fields to log.\n * @params msg {String} Log message. This can be followed by additional\n *    arguments that are handled like\n *    [util.format](http://nodejs.org/docs/latest/api/all.html#util.format).\n */\nLogger.prototype.trace = mkLogEmitter(TRACE);\nLogger.prototype.debug = mkLogEmitter(DEBUG);\nLogger.prototype.info = mkLogEmitter(INFO);\nLogger.prototype.warn = mkLogEmitter(WARN);\nLogger.prototype.error = mkLogEmitter(ERROR);\nLogger.prototype.fatal = mkLogEmitter(FATAL);\n\n\n\n//---- Standard serializers\n// A serializer is a function that serializes a JavaScript object to a\n// JSON representation for logging. There is a standard set of presumed\n// interesting objects in node.js-land.\n\nLogger.stdSerializers = {};\n\n// Serialize an HTTP request.\nLogger.stdSerializers.req = function (req) {\n    if (!req || !req.connection)\n        return req;\n    return {\n        method: req.method,\n        // Accept `req.originalUrl` for expressjs usage.\n        // https://expressjs.com/en/api.html#req.originalUrl\n        url: req.originalUrl || req.url,\n        headers: req.headers,\n        remoteAddress: req.connection.remoteAddress,\n        remotePort: req.connection.remotePort\n    };\n    // Trailers: Skipping for speed. If you need trailers in your app, then\n    // make a custom serializer.\n    //if (Object.keys(trailers).length > 0) {\n    //  obj.trailers = req.trailers;\n    //}\n};\n\n// Serialize an HTTP response.\nLogger.stdSerializers.res = function (res) {\n    if (!res || !res.statusCode)\n        return res;\n    return {\n        statusCode: res.statusCode,\n        header: res._header\n    }\n};\n\n\n/*\n * This function dumps long stack traces for exceptions having a cause()\n * method. The error classes from\n * [verror](https://github.com/davepacheco/node-verror) and\n * [restify v2.0](https://github.com/mcavage/node-restify) are examples.\n *\n * Based on `dumpException` in\n * https://github.com/davepacheco/node-extsprintf/blob/master/lib/extsprintf.js\n */\nfunction getFullErrorStack(ex)\n{\n    var ret = ex.stack || ex.toString();\n    if (ex.cause && typeof (ex.cause) === 'function') {\n        var cex = ex.cause();\n        if (cex) {\n            ret += '\\nCaused by: ' + getFullErrorStack(cex);\n        }\n    }\n    return (ret);\n}\n\n// Serialize an Error object\n// (Core error properties are enumerable in node 0.4, not in 0.6).\nvar errSerializer = Logger.stdSerializers.err = function (err) {\n    if (!err || !err.stack)\n        return err;\n    var obj = {\n        message: err.message,\n        name: err.name,\n        stack: getFullErrorStack(err),\n        code: err.code,\n        signal: err.signal\n    }\n    return obj;\n};\n\n\n// A JSON stringifier that handles cycles safely - tracks seen values in a Set.\nfunction safeCyclesSet() {\n    var seen = new Set();\n    return function (key, val) {\n        if (!val || typeof (val) !== 'object') {\n            return val;\n        }\n        if (seen.has(val)) {\n            return '[Circular]';\n        }\n        seen.add(val);\n        return val;\n    };\n}\n\n/**\n * A JSON stringifier that handles cycles safely - tracks seen vals in an Array.\n *\n * Note: This approach has performance problems when dealing with large objects,\n * see trentm/node-bunyan#445, but since this is the only option for node 0.10\n * and earlier (as Set was introduced in Node 0.12), it's used as a fallback\n * when Set is not available.\n */\nfunction safeCyclesArray() {\n    var seen = [];\n    return function (key, val) {\n        if (!val || typeof (val) !== 'object') {\n            return val;\n        }\n        if (seen.indexOf(val) !== -1) {\n            return '[Circular]';\n        }\n        seen.push(val);\n        return val;\n    };\n}\n\n/**\n * A JSON stringifier that handles cycles safely.\n *\n * Usage: JSON.stringify(obj, safeCycles())\n *\n * Choose the best safe cycle function from what is available - see\n * trentm/node-bunyan#445.\n */\nvar safeCycles = typeof (Set) !== 'undefined' ? safeCyclesSet : safeCyclesArray;\n\n/**\n * A fast JSON.stringify that handles cycles and getter exceptions (when\n * safeJsonStringify is installed).\n *\n * This function attempts to use the regular JSON.stringify for speed, but on\n * error (e.g. JSON cycle detection exception) it falls back to safe stringify\n * handlers that can deal with cycles and/or getter exceptions.\n */\nfunction fastAndSafeJsonStringify(rec) {\n    try {\n        return JSON.stringify(rec);\n    } catch (ex) {\n        try {\n            return JSON.stringify(rec, safeCycles());\n        } catch (e) {\n            if (safeJsonStringify) {\n                return safeJsonStringify(rec);\n            } else {\n                var dedupKey = e.stack.split(/\\n/g, 3).join('\\n');\n                _warn('bunyan: ERROR: Exception in '\n                    + '`JSON.stringify(rec)`. You can install the '\n                    + '\"safe-json-stringify\" module to have Bunyan fallback '\n                    + 'to safer stringification. Record:\\n'\n                    + _indent(format('%s\\n%s', util.inspect(rec), e.stack)),\n                    dedupKey);\n                return format('(Exception in JSON.stringify(rec): %j. '\n                    + 'See stderr for details.)', e.message);\n            }\n        }\n    }\n}\n\n\nvar RotatingFileStream = null;\nif (mv) {\n\nRotatingFileStream = function RotatingFileStream(options) {\n    this.path = options.path;\n\n    this.count = (options.count == null ? 10 : options.count);\n    assert.equal(typeof (this.count), 'number',\n        format('rotating-file stream \"count\" is not a number: %j (%s) in %j',\n            this.count, typeof (this.count), this));\n    assert.ok(this.count >= 0,\n        format('rotating-file stream \"count\" is not >= 0: %j in %j',\n            this.count, this));\n\n    // Parse `options.period`.\n    if (options.period) {\n        // <number><scope> where scope is:\n        //    h   hours (at the start of the hour)\n        //    d   days (at the start of the day, i.e. just after midnight)\n        //    w   weeks (at the start of Sunday)\n        //    m   months (on the first of the month)\n        //    y   years (at the start of Jan 1st)\n        // with special values 'hourly' (1h), 'daily' (1d), \"weekly\" (1w),\n        // 'monthly' (1m) and 'yearly' (1y)\n        var period = {\n            'hourly': '1h',\n            'daily': '1d',\n            'weekly': '1w',\n            'monthly': '1m',\n            'yearly': '1y'\n        }[options.period] || options.period;\n        var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);\n        if (!m) {\n            throw new Error(format('invalid period: \"%s\"', options.period));\n        }\n        this.periodNum = Number(m[1]);\n        this.periodScope = m[2];\n    } else {\n        this.periodNum = 1;\n        this.periodScope = 'd';\n    }\n\n    var lastModified = null;\n    try {\n        var fileInfo = fs.statSync(this.path);\n        lastModified = fileInfo.mtime.getTime();\n    }\n    catch (err) {\n        // file doesn't exist\n    }\n    var rotateAfterOpen = false;\n    if (lastModified) {\n        var lastRotTime = this._calcRotTime(0);\n        if (lastModified < lastRotTime) {\n            rotateAfterOpen = true;\n        }\n    }\n\n    // TODO: template support for backup files\n    // template: <path to which to rotate>\n    //      default is %P.%n\n    //      '/var/log/archive/foo.log'  -> foo.log.%n\n    //      '/var/log/archive/foo.log.%n'\n    //      codes:\n    //          XXX support strftime codes (per node version of those)\n    //              or whatever module. Pick non-colliding for extra\n    //              codes\n    //          %P      `path` base value\n    //          %n      integer number of rotated log (1,2,3,...)\n    //          %d      datetime in YYYY-MM-DD_HH-MM-SS\n    //                      XXX what should default date format be?\n    //                          prior art? Want to avoid ':' in\n    //                          filenames (illegal on Windows for one).\n\n    this.stream = fs.createWriteStream(this.path,\n        {flags: 'a', encoding: 'utf8'});\n\n    this.rotQueue = [];\n    this.rotating = false;\n    if (rotateAfterOpen) {\n        this._debug('rotateAfterOpen -> call rotate()');\n        this.rotate();\n    } else {\n        this._setupNextRot();\n    }\n}\n\nutil.inherits(RotatingFileStream, EventEmitter);\n\nRotatingFileStream.prototype._debug = function () {\n    // Set this to `true` to add debug logging.\n    if (false) {\n        if (arguments.length === 0) {\n            return true;\n        }\n        var args = Array.prototype.slice.call(arguments);\n        args[0] = '[' + (new Date().toISOString()) + ', '\n            + this.path + '] ' + args[0];\n        console.log.apply(this, args);\n    } else {\n        return false;\n    }\n};\n\nRotatingFileStream.prototype._setupNextRot = function () {\n    this.rotAt = this._calcRotTime(1);\n    this._setRotationTimer();\n}\n\nRotatingFileStream.prototype._setRotationTimer = function () {\n    var self = this;\n    var delay = this.rotAt - Date.now();\n    // Cap timeout to Node's max setTimeout, see\n    // <https://github.com/joyent/node/issues/8656>.\n    var TIMEOUT_MAX = 2147483647; // 2^31-1\n    if (delay > TIMEOUT_MAX) {\n        delay = TIMEOUT_MAX;\n    }\n    this.timeout = setTimeout(\n        function () {\n            self._debug('_setRotationTimer timeout -> call rotate()');\n            self.rotate();\n        },\n        delay);\n    if (typeof (this.timeout.unref) === 'function') {\n        this.timeout.unref();\n    }\n}\n\nRotatingFileStream.prototype._calcRotTime =\nfunction _calcRotTime(periodOffset) {\n    this._debug('_calcRotTime: %s%s', this.periodNum, this.periodScope);\n    var d = new Date();\n\n    this._debug('  now local: %s', d);\n    this._debug('    now utc: %s', d.toISOString());\n    var rotAt;\n    switch (this.periodScope) {\n    case 'ms':\n        // Hidden millisecond period for debugging.\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * periodOffset;\n        } else {\n            rotAt = Date.now() + this.periodNum * periodOffset;\n        }\n        break;\n    case 'h':\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 60 * 60 * 1000 * periodOffset;\n        } else {\n            // First time: top of the next hour.\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate(), d.getUTCHours() + periodOffset);\n        }\n        break;\n    case 'd':\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 24 * 60 * 60 * 1000\n                * periodOffset;\n        } else {\n            // First time: start of tomorrow (i.e. at the coming midnight) UTC.\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate() + periodOffset);\n        }\n        break;\n    case 'w':\n        // Currently, always on Sunday morning at 00:00:00 (UTC).\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 7 * 24 * 60 * 60 * 1000\n                * periodOffset;\n        } else {\n            // First time: this coming Sunday.\n            var dayOffset = (7 - d.getUTCDay());\n            if (periodOffset < 1) {\n                dayOffset = -d.getUTCDay();\n            }\n            if (periodOffset > 1 || periodOffset < -1) {\n                dayOffset += 7 * periodOffset;\n            }\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate() + dayOffset);\n        }\n        break;\n    case 'm':\n        if (this.rotAt) {\n            rotAt = Date.UTC(d.getUTCFullYear(),\n                d.getUTCMonth() + this.periodNum * periodOffset, 1);\n        } else {\n            // First time: the start of the next month.\n            rotAt = Date.UTC(d.getUTCFullYear(),\n                d.getUTCMonth() + periodOffset, 1);\n        }\n        break;\n    case 'y':\n        if (this.rotAt) {\n            rotAt = Date.UTC(d.getUTCFullYear() + this.periodNum * periodOffset,\n                0, 1);\n        } else {\n            // First time: the start of the next year.\n            rotAt = Date.UTC(d.getUTCFullYear() + periodOffset, 0, 1);\n        }\n        break;\n    default:\n        assert.fail(format('invalid period scope: \"%s\"', this.periodScope));\n    }\n\n    if (this._debug()) {\n        this._debug('  **rotAt**: %s (utc: %s)', rotAt,\n            new Date(rotAt).toUTCString());\n        var now = Date.now();\n        this._debug('        now: %s (%sms == %smin == %sh to go)',\n            now,\n            rotAt - now,\n            (rotAt-now)/1000/60,\n            (rotAt-now)/1000/60/60);\n    }\n    return rotAt;\n};\n\nRotatingFileStream.prototype.rotate = function rotate() {\n    // XXX What about shutdown?\n    var self = this;\n\n    // If rotation period is > ~25 days, we have to break into multiple\n    // setTimeout's. See <https://github.com/joyent/node/issues/8656>.\n    if (self.rotAt && self.rotAt > Date.now()) {\n        return self._setRotationTimer();\n    }\n\n    this._debug('rotate');\n    if (self.rotating) {\n        throw new TypeError('cannot start a rotation when already rotating');\n    }\n    self.rotating = true;\n\n    self.stream.end();  // XXX can do moves sync after this? test at high rate\n\n    function del() {\n        var toDel = self.path + '.' + String(n - 1);\n        if (n === 0) {\n            toDel = self.path;\n        }\n        n -= 1;\n        self._debug('  rm %s', toDel);\n        fs.unlink(toDel, function (delErr) {\n            //XXX handle err other than not exists\n            moves();\n        });\n    }\n\n    function moves() {\n        if (self.count === 0 || n < 0) {\n            return finish();\n        }\n        var before = self.path;\n        var after = self.path + '.' + String(n);\n        if (n > 0) {\n            before += '.' + String(n - 1);\n        }\n        n -= 1;\n        fs.exists(before, function (exists) {\n            if (!exists) {\n                moves();\n            } else {\n                self._debug('  mv %s %s', before, after);\n                mv(before, after, function (mvErr) {\n                    if (mvErr) {\n                        self.emit('error', mvErr);\n                        finish(); // XXX finish here?\n                    } else {\n                        moves();\n                    }\n                });\n            }\n        })\n    }\n\n    function finish() {\n        self._debug('  open %s', self.path);\n        self.stream = fs.createWriteStream(self.path,\n            {flags: 'a', encoding: 'utf8'});\n        var q = self.rotQueue, len = q.length;\n        for (var i = 0; i < len; i++) {\n            self.stream.write(q[i]);\n        }\n        self.rotQueue = [];\n        self.rotating = false;\n        self.emit('drain');\n        self._setupNextRot();\n    }\n\n    var n = this.count;\n    del();\n};\n\nRotatingFileStream.prototype.write = function write(s) {\n    if (this.rotating) {\n        this.rotQueue.push(s);\n        return false;\n    } else {\n        return this.stream.write(s);\n    }\n};\n\nRotatingFileStream.prototype.end = function end(s) {\n    this.stream.end();\n};\n\nRotatingFileStream.prototype.destroy = function destroy(s) {\n    this.stream.destroy();\n};\n\nRotatingFileStream.prototype.destroySoon = function destroySoon(s) {\n    this.stream.destroySoon();\n};\n\n} /* if (mv) */\n\n\n\n/**\n * RingBuffer is a Writable Stream that just stores the last N records in\n * memory.\n *\n * @param options {Object}, with the following fields:\n *\n *    - limit: number of records to keep in memory\n */\nfunction RingBuffer(options) {\n    this.limit = options && options.limit ? options.limit : 100;\n    this.writable = true;\n    this.records = [];\n    EventEmitter.call(this);\n}\n\nutil.inherits(RingBuffer, EventEmitter);\n\nRingBuffer.prototype.write = function (record) {\n    if (!this.writable)\n        throw (new Error('RingBuffer has been ended already'));\n\n    this.records.push(record);\n\n    if (this.records.length > this.limit)\n        this.records.shift();\n\n    return (true);\n};\n\nRingBuffer.prototype.end = function () {\n    if (arguments.length > 0)\n        this.write.apply(this, Array.prototype.slice.call(arguments));\n    this.writable = false;\n};\n\nRingBuffer.prototype.destroy = function () {\n    this.writable = false;\n    this.emit('close');\n};\n\nRingBuffer.prototype.destroySoon = function () {\n    this.destroy();\n};\n\n\n//---- Exports\n\nmodule.exports = Logger;\n\nmodule.exports.TRACE = TRACE;\nmodule.exports.DEBUG = DEBUG;\nmodule.exports.INFO = INFO;\nmodule.exports.WARN = WARN;\nmodule.exports.ERROR = ERROR;\nmodule.exports.FATAL = FATAL;\nmodule.exports.resolveLevel = resolveLevel;\nmodule.exports.levelFromName = levelFromName;\nmodule.exports.nameFromLevel = nameFromLevel;\n\nmodule.exports.VERSION = VERSION;\nmodule.exports.LOG_VERSION = LOG_VERSION;\n\nmodule.exports.createLogger = function createLogger(options) {\n    return new Logger(options);\n};\n\nmodule.exports.RingBuffer = RingBuffer;\nmodule.exports.RotatingFileStream = RotatingFileStream;\n\n// Useful for custom `type == 'raw'` streams that may do JSON stringification\n// of log records themselves. Usage:\n//    var str = JSON.stringify(rec, bunyan.safeCycles());\nmodule.exports.safeCycles = safeCycles;\n"]},"metadata":{},"sourceType":"script"}