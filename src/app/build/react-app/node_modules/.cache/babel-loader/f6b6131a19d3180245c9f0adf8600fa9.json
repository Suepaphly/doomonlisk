{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.deleteVoteWeightsUntilRound = exports.setVoteWeights = exports.getVoteWeights = exports.setRegisteredDelegates = exports.getRegisteredDelegates = void 0;\n\nvar lisk_codec_1 = require(\"@liskhq/lisk-codec\");\n\nvar constants_1 = require(\"./constants\");\n\nvar schema_1 = require(\"./schema\");\n\nvar getRegisteredDelegates = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(store) {\n    var usernamesBuffer, parsedUsernames;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return store.chain.get(constants_1.CHAIN_STATE_DELEGATE_USERNAMES);\n\n          case 2:\n            usernamesBuffer = _context.sent;\n\n            if (usernamesBuffer) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              registeredDelegates: []\n            });\n\n          case 5:\n            parsedUsernames = lisk_codec_1.codec.decode(schema_1.delegatesUserNamesSchema, usernamesBuffer);\n            return _context.abrupt(\"return\", parsedUsernames);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getRegisteredDelegates(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.getRegisteredDelegates = getRegisteredDelegates;\n\nvar setRegisteredDelegates = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(store, usernames) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            usernames.registeredDelegates.sort(function (a, b) {\n              return a.address.compare(b.address);\n            });\n            _context2.next = 3;\n            return store.chain.set(constants_1.CHAIN_STATE_DELEGATE_USERNAMES, lisk_codec_1.codec.encode(schema_1.delegatesUserNamesSchema, usernames));\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function setRegisteredDelegates(_x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.setRegisteredDelegates = setRegisteredDelegates;\n\nvar getVoteWeights = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(stateStore) {\n    var voteWeights, voteWeightsDecoded;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return stateStore.chain.get(constants_1.CHAIN_STATE_DELEGATE_VOTE_WEIGHTS);\n\n          case 2:\n            voteWeights = _context3.sent;\n\n            if (voteWeights) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", []);\n\n          case 5:\n            voteWeightsDecoded = lisk_codec_1.codec.decode(schema_1.voteWeightsSchema, voteWeights);\n            return _context3.abrupt(\"return\", voteWeightsDecoded.voteWeights);\n\n          case 7:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getVoteWeights(_x4) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.getVoteWeights = getVoteWeights;\n\nvar setVoteWeights = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(stateStore, voteWeights) {\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return stateStore.chain.set(constants_1.CHAIN_STATE_DELEGATE_VOTE_WEIGHTS, lisk_codec_1.codec.encode(schema_1.voteWeightsSchema, {\n              voteWeights: voteWeights\n            }));\n\n          case 2:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function setVoteWeights(_x5, _x6) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexports.setVoteWeights = setVoteWeights;\n\nvar deleteVoteWeightsUntilRound = /*#__PURE__*/function () {\n  var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(round, stateStore) {\n    var voteWeights, newVoteWeights;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return exports.getVoteWeights(stateStore);\n\n          case 2:\n            voteWeights = _context5.sent;\n            newVoteWeights = voteWeights.filter(function (vw) {\n              return vw.round >= round;\n            });\n            _context5.next = 6;\n            return exports.setVoteWeights(stateStore, newVoteWeights);\n\n          case 6:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function deleteVoteWeightsUntilRound(_x7, _x8) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexports.deleteVoteWeightsUntilRound = deleteVoteWeightsUntilRound;","map":{"version":3,"sources":["../../../src/modules/dpos/data_access.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.deleteVoteWeightsUntilRound = exports.setVoteWeights = exports.getVoteWeights = exports.setRegisteredDelegates = exports.getRegisteredDelegates = void 0;\nconst lisk_codec_1 = require(\"@liskhq/lisk-codec\");\nconst constants_1 = require(\"./constants\");\nconst schema_1 = require(\"./schema\");\nconst getRegisteredDelegates = async (store) => {\n    const usernamesBuffer = await store.chain.get(constants_1.CHAIN_STATE_DELEGATE_USERNAMES);\n    if (!usernamesBuffer) {\n        return { registeredDelegates: [] };\n    }\n    const parsedUsernames = lisk_codec_1.codec.decode(schema_1.delegatesUserNamesSchema, usernamesBuffer);\n    return parsedUsernames;\n};\nexports.getRegisteredDelegates = getRegisteredDelegates;\nconst setRegisteredDelegates = async (store, usernames) => {\n    usernames.registeredDelegates.sort((a, b) => a.address.compare(b.address));\n    await store.chain.set(constants_1.CHAIN_STATE_DELEGATE_USERNAMES, lisk_codec_1.codec.encode(schema_1.delegatesUserNamesSchema, usernames));\n};\nexports.setRegisteredDelegates = setRegisteredDelegates;\nconst getVoteWeights = async (stateStore) => {\n    const voteWeights = await stateStore.chain.get(constants_1.CHAIN_STATE_DELEGATE_VOTE_WEIGHTS);\n    if (!voteWeights) {\n        return [];\n    }\n    const voteWeightsDecoded = lisk_codec_1.codec.decode(schema_1.voteWeightsSchema, voteWeights);\n    return voteWeightsDecoded.voteWeights;\n};\nexports.getVoteWeights = getVoteWeights;\nconst setVoteWeights = async (stateStore, voteWeights) => {\n    await stateStore.chain.set(constants_1.CHAIN_STATE_DELEGATE_VOTE_WEIGHTS, lisk_codec_1.codec.encode(schema_1.voteWeightsSchema, { voteWeights }));\n};\nexports.setVoteWeights = setVoteWeights;\nconst deleteVoteWeightsUntilRound = async (round, stateStore) => {\n    const voteWeights = await exports.getVoteWeights(stateStore);\n    const newVoteWeights = voteWeights.filter(vw => vw.round >= round);\n    await exports.setVoteWeights(stateStore, newVoteWeights);\n};\nexports.deleteVoteWeightsUntilRound = deleteVoteWeightsUntilRound;\n//# sourceMappingURL=data_access.js.map"]},"metadata":{},"sourceType":"script"}