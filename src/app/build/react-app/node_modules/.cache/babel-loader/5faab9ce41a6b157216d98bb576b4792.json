{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"/home/lisk/doomonlisk/src/app/build/react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isCurrentlyPunished = exports.validateSignature = exports.isUsername = exports.isNullCharacterIncluded = exports.getMinWaitingHeight = exports.getPunishmentPeriod = exports.getMinPunishedHeight = exports.sortUnlocking = void 0;\n\nvar lisk_cryptography_1 = require(\"@liskhq/lisk-cryptography\");\n\nvar constants_1 = require(\"./constants\");\n\nvar sortUnlocking = function sortUnlocking(unlocks) {\n  unlocks.sort(function (a, b) {\n    if (!a.delegateAddress.equals(b.delegateAddress)) {\n      return a.delegateAddress.compare(b.delegateAddress);\n    }\n\n    if (a.unvoteHeight !== b.unvoteHeight) {\n      return b.unvoteHeight - a.unvoteHeight;\n    }\n\n    var diff = b.amount - a.amount;\n\n    if (diff > BigInt(0)) {\n      return 1;\n    }\n\n    if (diff < BigInt(0)) {\n      return -1;\n    }\n\n    return 0;\n  });\n};\n\nexports.sortUnlocking = sortUnlocking;\n\nvar getMinPunishedHeight = function getMinPunishedHeight(sender, delegate) {\n  if (delegate.dpos.delegate.pomHeights.length === 0) {\n    return 0;\n  }\n\n  var lastPomHeight = Math.max.apply(Math, _toConsumableArray(delegate.dpos.delegate.pomHeights));\n  return sender.address.equals(delegate.address) ? lastPomHeight + constants_1.SELF_VOTE_PUNISH_TIME : lastPomHeight + constants_1.VOTER_PUNISH_TIME;\n};\n\nexports.getMinPunishedHeight = getMinPunishedHeight;\n\nvar getPunishmentPeriod = function getPunishmentPeriod(sender, delegateAccount, lastBlockHeight) {\n  var currentHeight = lastBlockHeight + 1;\n  var minPunishedHeight = exports.getMinPunishedHeight(sender, delegateAccount);\n  var remainingBlocks = minPunishedHeight - currentHeight;\n  return remainingBlocks < 0 ? 0 : remainingBlocks;\n};\n\nexports.getPunishmentPeriod = getPunishmentPeriod;\n\nvar getMinWaitingHeight = function getMinWaitingHeight(senderAddress, delegateAddress, unlockObject) {\n  return unlockObject.unvoteHeight + (senderAddress.equals(delegateAddress) ? constants_1.WAIT_TIME_SELF_VOTE : constants_1.WAIT_TIME_VOTE);\n};\n\nexports.getMinWaitingHeight = getMinWaitingHeight;\n\nvar isNullCharacterIncluded = function isNullCharacterIncluded(input) {\n  return new RegExp(/\\\\0|\\\\u0000|\\\\x00/).test(input);\n};\n\nexports.isNullCharacterIncluded = isNullCharacterIncluded;\n\nvar isUsername = function isUsername(username) {\n  if (exports.isNullCharacterIncluded(username)) {\n    return false;\n  }\n\n  if (username !== username.trim().toLowerCase()) {\n    return false;\n  }\n\n  return /^[a-z0-9!@$&_.]+$/g.test(username);\n};\n\nexports.isUsername = isUsername;\n\nvar validateSignature = function validateSignature(publicKey, signature, bytes) {\n  return lisk_cryptography_1.verifyData(bytes, signature, publicKey);\n};\n\nexports.validateSignature = validateSignature;\n\nvar isCurrentlyPunished = function isCurrentlyPunished(height, pomHeights) {\n  if (pomHeights.length === 0) {\n    return false;\n  }\n\n  var lastPomHeight = Math.max.apply(Math, _toConsumableArray(pomHeights));\n\n  if (height - lastPomHeight < constants_1.PUNISHMENT_PERIOD) {\n    return true;\n  }\n\n  return false;\n};\n\nexports.isCurrentlyPunished = isCurrentlyPunished;","map":{"version":3,"sources":["../../../src/modules/dpos/utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isCurrentlyPunished = exports.validateSignature = exports.isUsername = exports.isNullCharacterIncluded = exports.getMinWaitingHeight = exports.getPunishmentPeriod = exports.getMinPunishedHeight = exports.sortUnlocking = void 0;\nconst lisk_cryptography_1 = require(\"@liskhq/lisk-cryptography\");\nconst constants_1 = require(\"./constants\");\nconst sortUnlocking = (unlocks) => {\n    unlocks.sort((a, b) => {\n        if (!a.delegateAddress.equals(b.delegateAddress)) {\n            return a.delegateAddress.compare(b.delegateAddress);\n        }\n        if (a.unvoteHeight !== b.unvoteHeight) {\n            return b.unvoteHeight - a.unvoteHeight;\n        }\n        const diff = b.amount - a.amount;\n        if (diff > BigInt(0)) {\n            return 1;\n        }\n        if (diff < BigInt(0)) {\n            return -1;\n        }\n        return 0;\n    });\n};\nexports.sortUnlocking = sortUnlocking;\nconst getMinPunishedHeight = (sender, delegate) => {\n    if (delegate.dpos.delegate.pomHeights.length === 0) {\n        return 0;\n    }\n    const lastPomHeight = Math.max(...delegate.dpos.delegate.pomHeights);\n    return sender.address.equals(delegate.address)\n        ? lastPomHeight + constants_1.SELF_VOTE_PUNISH_TIME\n        : lastPomHeight + constants_1.VOTER_PUNISH_TIME;\n};\nexports.getMinPunishedHeight = getMinPunishedHeight;\nconst getPunishmentPeriod = (sender, delegateAccount, lastBlockHeight) => {\n    const currentHeight = lastBlockHeight + 1;\n    const minPunishedHeight = exports.getMinPunishedHeight(sender, delegateAccount);\n    const remainingBlocks = minPunishedHeight - currentHeight;\n    return remainingBlocks < 0 ? 0 : remainingBlocks;\n};\nexports.getPunishmentPeriod = getPunishmentPeriod;\nconst getMinWaitingHeight = (senderAddress, delegateAddress, unlockObject) => unlockObject.unvoteHeight +\n    (senderAddress.equals(delegateAddress) ? constants_1.WAIT_TIME_SELF_VOTE : constants_1.WAIT_TIME_VOTE);\nexports.getMinWaitingHeight = getMinWaitingHeight;\nconst isNullCharacterIncluded = (input) => new RegExp(/\\\\0|\\\\u0000|\\\\x00/).test(input);\nexports.isNullCharacterIncluded = isNullCharacterIncluded;\nconst isUsername = (username) => {\n    if (exports.isNullCharacterIncluded(username)) {\n        return false;\n    }\n    if (username !== username.trim().toLowerCase()) {\n        return false;\n    }\n    return /^[a-z0-9!@$&_.]+$/g.test(username);\n};\nexports.isUsername = isUsername;\nconst validateSignature = (publicKey, signature, bytes) => lisk_cryptography_1.verifyData(bytes, signature, publicKey);\nexports.validateSignature = validateSignature;\nconst isCurrentlyPunished = (height, pomHeights) => {\n    if (pomHeights.length === 0) {\n        return false;\n    }\n    const lastPomHeight = Math.max(...pomHeights);\n    if (height - lastPomHeight < constants_1.PUNISHMENT_PERIOD) {\n        return true;\n    }\n    return false;\n};\nexports.isCurrentlyPunished = isCurrentlyPunished;\n//# sourceMappingURL=utils.js.map"]},"metadata":{},"sourceType":"script"}